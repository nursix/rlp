/*
 2015-2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,l,e){a instanceof String&&(a=String(a));for(var b=a.length,c=0;c<b;c++){var d=a[c];if(l.call(e,d,c,a))return{i:c,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,l,e){a!=Array.prototype&&a!=Object.prototype&&(a[l]=e.value)};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var l=0;l<a.length;++l){var e=a[l];if(e&&e.Math==Math)return e}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,l,e,b){if(l){e=$jscomp.global;a=a.split(".");for(b=0;b<a.length-1;b++){var c=a[b];c in e||(e[c]={});e=e[c]}a=a[a.length-1];b=e[a];l=l(b);l!=b&&null!=l&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:l})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6","es3");
(function(a,l){var e=0;a.widget("s3.groupedItems",{options:{ajaxURL:null,renderGroupHeaders:!1,totalsLabel:"TOTAL"},_create:function(){a(this.element);this.id=e;e+=1;this.eventNamespace=".groupeditems"},_init:function(){var b=a(this.element);this.widget_id=b.attr("id");this.items=b.find(".gi-data").first();this.refresh()},_destroy:function(){a.Widget.prototype.destroy.call(this)},refresh:function(){var b=a(this.element);b.find(".gi-throbber").show();this._unbindEvents();this.data||this._deserialize();
var c=this.data,d=b.find(".gi-table");c.e?(d.hide(),d.empty(),b.find(".gi-empty").show()):(b.find(".gi-empty").hide(),d.empty(),c=this._renderTable(c),d.append(c).show());this._bindEvents();b.find(".gi-throbber").css("visibility","hidden")},_renderTable:function(b){var c=a('<table class="groupeditems">');this._renderTableHeader(b).appendTo(c);this._renderGroup(c,b);this._renderTableFooter(b).appendTo(c);return c},_renderTableHeader:function(b){var c=a("<thead>"),d=a('<tr class="gi-column-headers">').appendTo(c),
f=b.c;b=b.l;for(var q,k=0,h=f.length;k<h;k++)q=b[f[k]],a("<th>").html(q).appendTo(d);return c},_renderTableFooter:function(b){var c=this.options,d=a("<tfoot>"),f=a('<tr class="gi-column-totals">'),q=b.t,k=!1;for(m in q){k=!0;break}if(k){b=b.c;for(var h=null,g=0,e=0,p=b.length;e<p;e++){if(!h){if(!q.hasOwnProperty(b[e])){g++;continue}1<g&&(h=a('<td class="gi-column-totals-label" colspan="'+g+'">'),a("<span> "+c.totalsLabel+"</span>").appendTo(h),h.appendTo(f))}var m=a("<td>").appendTo(f);(k=q[b[e]])&&
m.html(k)}f.appendTo(d)}return d},_renderGroup:function(b,c,a,f){"undefined"==typeof a&&(a=c);"undefined"==typeof f&&(f=0);this.options.renderGroupHeaders&&0<f&&this._renderGroupHeader(b,c,a,f);var d=a.d,k=a.i,h;if(d){var g=0;for(h=d.length;g<h;g++)this._renderGroup(b,c,d[g],f+1)}else if(k)for(g=0,h=k.length;g<h;g++)this._renderItem(b,c,k[g],f);0<f&&this._renderGroupFooter(b,c,a,f)},_renderGroupHeader:function(b,c,d,f){c=c.c;d=d.v;f=a('<tr class="gi-group-header gi-level-'+f+'">');a('<td colspan="'+
c.length+'">').html(d).appendTo(f);f.appendTo(b)},_renderGroupFooter:function(b,c,d,f){var q=this.options,k=d.t,h=!1;for(g in k){h=!0;break}c=c.c;d=d.v;f=a('<tr class="gi-group-footer gi-level-'+f+'">');if(!h&&!q.renderGroupHeaders)a('<td colspan="'+c.length+'">').html(d).appendTo(f),f.appendTo(b);else if(h){h=0;var g=null;for(var e,p,m=0,n=c.length;m<n;m++){if(!g){if(!k.hasOwnProperty(c[m])){h++;continue}1<h&&(g=a('<td class="gi-group-footer-label" colspan="'+h+'">'),q.renderGroupHeaders||g.html(d),
a('<span class="gi-group-footer-inline-label"> '+q.totalsLabel+"</span>").appendTo(g),g.appendTo(f))}p=a("<td>").appendTo(f);(e=k[c[m]])&&p.html(e)}f.appendTo(b)}},_renderItem:function(b,c,d,f){f=a('<tr class="gi-item gi-level-'+f+'">');c=c.c;for(var e,k,h=0,g=c.length;h<g;h++)k=a("<td>"),(e=d[c[h]])&&k.html(e),k.appendTo(f);f.appendTo(b)},reload:function(b,c,d){d="undefined"!=typeof d?d:!0;"undefined"==typeof c&&(c=this._getFilters());var f=this,e=!1;a(this.element).find(".gi-throbber").css("visibility",
"visible");if(b||c)e=this._updateAjaxURL(b,c);e||d?a.ajax({url:this.options.ajaxURL,dataType:"json"}).done(function(b){f.items.val(JSON.stringify(b));f.data=null;f.refresh()}).fail(function(b,a,c){msg="UNAUTHORIZED"==c?i18n.gis_requires_login:b.responseText;console.log(msg)}):f.refresh()},_getFilters:function(){var b=a("#"+this.widget_id+"-filter-form");try{return b.length?S3.search.getCurrentFilters(b.first()):null}catch(c){return null}},_updateAjaxURL:function(b,c){var d=this.options.ajaxURL;if(!d)return!1;
var f=d.split("?");if(1<f.length){var e=f[1];var k=e.split("&")}else k=[];var h=[];d=!1;if(b)for(var g in b)e=b[g],e=g+"="+e,d||-1!=a.inArray(e,k)||(d=!0),h.push(e);g={};e={};var l;if(c){var p=0;for(l=c.length;p<l;p++){var m=c[p];var n=m[0];m=m[1];null===m?g[n]||(e[n]=!0):(e[n]&&(e[n]=!1),m=n+"="+encodeURIComponent(m),g[n]?g[n].push(m):g[n]=[m])}}p=0;for(l=k.length;p<l;p++)m=k[p].split("="),1<m.length&&(n=decodeURIComponent(m[0]),m=decodeURIComponent(m[1]),e[n]?d=!0:g[n]?d||-1!=a.inArray(n+"="+m,
g[n])||(d=!0):b&&b.hasOwnProperty(n)||h.push(k[p]));for(n in g)for(p=0,l=g[n].length;p<l;p++)d||-1!=a.inArray(g[n][p],k)||(d=!0),h.push(g[n][p]);b=h.join("&");c=f[0];b&&(c=c+"?"+b);this.options.ajaxURL=c;return d},_serialize:function(){var b=this.items;if(b){var a="";this.data&&(a=JSON.stringify(this.data));b.val(a)}return a},_deserialize:function(){this.data={};var a=this.items;a&&(a=a.val())&&(this.data=JSON.parse(a));return this.data},_bindEvents:function(){var b=this;a(this.element).delegate(".gi-export",
"click"+this.eventNamespace,function(){var c=a(this).data("url"),d=b._getFilters();d&&(c=S3.search.filterURL(c,d));window.open(c)})},_unbindEvents:function(){a(this.element).undelegate(this.eventNamespace)}})})(jQuery);
