/*
 2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery UI MultiSelect Widget 1.14 by Eric Hynds
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(b){var e=0;return function(){return e<b.length?{done:!1,value:b[e++]}:{done:!0}}};$jscomp.arrayIterator=function(b){return{next:$jscomp.arrayIteratorImpl(b)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,e,d){b!=Array.prototype&&b!=Object.prototype&&(b[e]=d.value)};$jscomp.getGlobal=function(b){b=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,b];for(var e=0;e<b.length;++e){var d=b[e];if(d&&d.Math==Math)return d}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(b,e){this.$jscomp$symbol$id_=b;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:e})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function b(d){if(this instanceof b)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(d||"")+"_"+e++,d)}var e=0;return b}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.asyncIterator;b||(b=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};
$jscomp.iteratorFromArray=function(b,e){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var d=0,a={next:function(){if(d<b.length){var c=d++;return{value:e(c,b[c]),done:!1}}a.next=function(){return{done:!0,value:void 0}};return a.next()}};a[Symbol.iterator]=function(){return a};return a};
$jscomp.polyfill=function(b,e,d,a){if(e){d=$jscomp.global;b=b.split(".");for(a=0;a<b.length-1;a++){var c=b[a];c in d||(d[c]={});d=d[c]}b=b[b.length-1];a=d[b];e=e(a);e!=a&&null!=e&&$jscomp.defineProperty(d,b,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
(function(b,e){var d=0;b.widget("s3.cascadeSelect",{options:{multiple:!0,leafonly:!0,cascade:!0},_create:function(){this.id=d;d+=1;this.eventNamespace=".cascadeSelect"},_init:function(){var a=b(this.element);this.hiddenInput=b(".s3-cascade-input",a).first();this.refresh()},_destroy:function(){b.Widget.prototype.destroy.call(this)},refresh:function(){var a=b(this.element);this._unbindEvents();var c=[];b("select.s3-cascade-select",a).each(function(){c.push(b(this).empty().data("available",{}))});c.sort(function(a,
b){return a.data("level")-b.data("level")});this.selectors=c;a=this._getHierarchy();for(var g in a)this._addAvailableOption(null,0,g,a[g]);this._renderOptions(c[0],Object.keys(a),[]);g=this._deserialize();this._updateOptions(c[c.length-1],g);this._multiSelectInit();this._bindEvents()},get:function(){return this._deserialize()},set:function(a){this.reset();if(a){a.constructor!==Array&&(a=[a]);a=a.map(function(a){return""+a});var b=this.selectors;this._updateOptions(b[b.length-1],a);this._serialize();
return this}},reset:function(){this.selectors.forEach(function(a,c){a.val("");0<c&&b("option",a).remove();(a=a.multiselect("instance"))&&a.refresh()});this._serialize();this._toggleSelectors();return this},_deserialize:function(){var a=JSON.parse(this.hiddenInput.val());return a?a.map(function(a){return""+a}):[]},_serialize:function(){for(var a=this.options,b=[],g=this.selectors,h=g.length;h--;){var e=g[h],f=e.prop("multiple"),k=e.data("available");e=this._getSelected(e);for(var l=0,d=e.length;l<
d;l++){var m=e[l],n=k[m];if(!(!n||a.leafonly&&n[3])&&(-1==b.indexOf(m)&&b.push(m),b.length&&!f))break}if(b.length&&!f)break}this.hiddenInput.val(JSON.stringify(b)).trigger("select.s3hierarchy")},_multiSelectInit:function(){this.selectors.forEach(function(a){a.multiselect("instance")?a.multiselect("refresh"):a.prop("multiple")&&a.multiselect({})})},_getHierarchy:function(){var a=b(this).element,c=this.hierarchy;c===e&&(a=b(".s3-cascade",a),this.hierarchy=c=JSON.parse(a.val()));return c},_updateOptions:function(a,
b,g){var c=a.data("level"),d=a.data("available"),f=[];b=b.slice(0);this._getSelected(a).forEach(function(a){-1!=b.indexOf(a)||g&&-1==g.indexOf(a)||b.push(a)});if(0===c)this._setSelected(a,b);else if(g)this._renderOptions(a,g,b);else{var k=b.slice(0);b.forEach(function(a){a=d[a];a!==e&&-1==k.indexOf(a[0])&&k.push(a[0])});this._updateOptions(this.selectors[c-1],k)}if(0===c||g)a=this.selectors[c+1],a!==e?(b.forEach(function(a){a=d[a];a!==e&&(f=f.concat(Object.keys(a[3])))}),this._updateOptions(a,b,f)):
this._toggleSelectors()},_renderOptions:function(a,c,e){var d=this.options;!d.multiple&&d.cascade&&1==c.length&&(d=c[0],-1==e.indexOf(d)&&e.push(d));var g=a.data("available");a.empty();var f=[];c.forEach(function(a){var b=g[a];b&&f.push([a,b[1]])});f.sort(function(a,b){return a[1].localeCompare(b[1])});f.forEach(function(c){b("<option>").val(c[0]).text(c[1]).appendTo(a)});this._setSelected(a,e)},_getSelected:function(a){return(a=b(a).val())?a.constructor===Array?a.map(function(a){return""+a}):[""+
a]:[]},_setSelected:function(a,b){var c=a.data("available"),d=a.multiselect("instance");b=b.filter(function(a){return c[""+a]!==e});a.prop("multiple")?a.val(b):a.val(b[0]);d&&d.refresh()},_addAvailableOption:function(a,b,d,h){var c=this.selectors[b];if(c){var f=c.data("available");if(f===e||null===f)f={};f[""+d]=[""+a].concat(h);c.data("available",f);if((a=h[2])&&!0!==a)for(var g in a)this._addAvailableOption(d,b+1,g,a[g])}},_toggleSelectors:function(){this.selectors.forEach(function(a){var c=a.multiselect("instance");
b("option",a).length?(a.prop("disabled",!1),c&&c.enable()):(a.prop("disabled",!0),c&&c.disable())})},_hiddenBranches:function(a,c){var e=[],d=a.data("level");if(d=this.selectors[d+1]){var p=a.data("available"),f={};c.forEach(function(a){if((a=p[a])&&(a=a[3])&&!0!==a)for(var b in a)f[""+b]=!0});b("option",d).each(function(){f[b(this).val()]=!1});e=Object.keys(f).filter(function(a){return f[a]});e=e.concat(this._hiddenBranches(d,e))}return e},_bindEvents:function(){var a=b(this.element),c=this.eventNamespace,
e=this.options,d=this;b("select.s3-cascade-select",a).on("change"+c,function(){var a=b(this),c=d._getSelected(a);e.multiple&&e.cascade&&d._hiddenBranches(a,c).forEach(function(a){-1==c.indexOf(a)&&c.push(a)});d._updateOptions(a,c);d._serialize()});return!0},_unbindEvents:function(){var a=b(this.element),c=this.eventNamespace;b("select.s3-cascade-select",a).off(c);return!0}})})(jQuery);
