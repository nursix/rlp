var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,b){a instanceof String&&(a=String(a));for(var f=a.length,h=0;h<f;h++){var p=a[h];if(e.call(b,p,h,a))return{i:h,v:p}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,b){a!=Array.prototype&&a!=Object.prototype&&(a[e]=b.value)};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var e=0;e<a.length;++e){var b=a[e];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,e,b,f){if(e){b=$jscomp.global;a=a.split(".");for(f=0;f<a.length-1;f++){var h=a[f];h in b||(b[h]={});b=b[h]}a=a[a.length-1];f=b[a];e=e(f);e!=f&&null!=e&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6","es3");
(function(a,e){function b(a){a=a.find("[name=_formname]").val();if("undefined"!=typeof a){if("cap_alert"==a.substring(0,9))return"cap_alert";if("cap_info"==a.substring(0,8))return"cap_info"}return""}function f(){return 0<a(".cap_info_template_form").length}function h(a){return"cap_alert"==a?["codes","note","incidents"]:"cap_info"==a?"category event response_type urgency severity certainty audience event_code effective onset expires sender_name headline description instruction contact web parameter".split(" "):
[]}function p(d){function e(g,e){var c=b(d),f=h(c),k={};"undefined"==typeof e&&(e=!1);if(g)"cap_alert"==c?(n=g.$_cap_alert&&g.$_cap_alert[0]||{},k=a.parseJSON(n.template_settings)||{},a(".cap_alert_form").addClass("template_loaded")):"cap_info"==c&&(n=g.$_cap_info&&g.$_cap_info[0]||{},k={});else{var n={};k={}}a.each(f,function(g,b){try{var c=d.find("[name="+b+"]"),f=k.locked&&k.locked[b];switch(typeof n[b]){case "string":"restriction"==b?(c.val(n[b]||""),""!=c.val()&&m.show()):(l.show(),m.hide());
case "undefined":if(c.is(":text")||c.is("textarea")||c.is("select"))(e||f)&&c.val(n[b]||""),f?c.prop("disabled",!0).attr("title","This field is locked by the template"):c.prop("disabled",!1).attr("title","");break;case "object":var h=["scope","addresses","codes"];for(g=0;g<h.length;g++)b==h[g]&&c.val(n[b]["@value"]||"");"incidents"==b&&(e||f)&&(c.val(n[b]["@value"]||""),a("select#cap_alert_incidents").multiselect("refresh"))}}catch(q){s3_debug("ERROR",q)}})}function k(b,d,c){if(b){"undefined"==typeof c&&
(c="template");var g=new RegExp(".*\\"+S3.Ap+"\\/");g=(new String(self.location)).replace(g,"").split("?")[0].split("/")[0];b=[S3.Ap,g,c,b].join("/")+".s3json";a.ajax({url:b,type:"GET",dataType:"json",success:function(a){e(a,d)},error:function(a){alert("There was an unexpected error loading template data")}})}}var m=a("#cap_alert_restriction__row, #cap_alert_restriction__row1"),l=a("#cap_alert_addresses__row, #cap_alert_addresses__row1");"Restricted"==a("#cap_alert_scope").val()?(m.show(),l.hide()):
("Public"==a("#cap_alert_scope").val()||"Private"==a("#cap_alert_scope").val()?l.show():l.hide(),m.hide());a("#cap_alert_scope").change(function(){switch(a(this).val()){case "Public":m.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");l.show();break;case "Restricted":l.hide();a("#cap_alert_addresses").val()&&a("#cap_alert_addresses").val("");m.show();break;case "Private":m.hide();a("#cap_alert_restriction").val()&&a("#cap_alert_restriction").val("");l.show();break;case "":l.hide(),
m.hide()}});a("#cap_info_priority").change(function(){if(a(this).val()){var b=S3.cap_priorities,e=b.length;"Undefined"==a(this).find("option:selected").text()&&(a(this).css("border","2px solid gray"),d.find("[name=urgency]").val(""),d.find("[name=severity]").val(""),d.find("[name=certainty]").val(""));for(var c=0;c<e;c++)b[c][0]==a(this).find("option:selected").text()&&(d.find("[name=urgency]").val(b[c][1]),d.find("[name=severity]").val(b[c][2]),d.find("[name=certainty]").val(b[c][3]),a(this).css("border",
"2px solid #"+b[c][4]))}else a(this).css("border","1px solid gray")});d.find("[name=template_id]").change(function(){k(a(this).val(),!0)});"cap_alert"!=b(d)||0<a(".cap_template_form").length||k(d.find("[name=template_id]").val());"cap_info"!=b(d)||f()||k(d.find("[name=template_info_id]").val(),!1,"info");window.apply_temp=k}function r(d){function f(){try{return a.parseJSON(d.find("[name=template_settings]").val())||{}}catch(m){return s3_debug("Error occured parsing: ",d.find("[name=template_settings]").val()),
{}}}function k(b,l){var g="can_edit-"+b,h=a('<label for="'+g+'">'+(i18n.cap_locked||"Locked")+"</label>");g=a('<input type="checkbox" name="'+g+'"/>');g.change(function(){var c=f();c.locked=c.locked||{};c.locked[b]=a(this).is(":checked");d.find("[name=template_settings]").val(e.stringify(c))});var c=f();c.locked&&c.locked[b]&&g.prop("checked","checked");l.append(h);l.append(g)}d.find("[name=is_template]").prop("checked","checked");tablename=b(d);fields=h(tablename);d.find("tr").each(function(){var b=
a(this),d=b.attr("id");d&&d.match("__row$")&&(d=d.replace(tablename+"_","").replace("__row",""),b=b.find("td.w2p_fc")||b.find("td").eq(1),0<=fields.indexOf(d)&&k(d,b))})}var u=function(){a(".cap-clone-update").unbind(".cap").bind("click.cap",function(){t(a(this).attr("data"))})},t=function(b){var d=b.split("/")[0];(b=b.split("/").pop())&&a.ajax({url:S3.Ap.concat("/cap/alert/")+b+"/clone?msg_type="+d,success:function(a){window.location.href=S3.Ap.concat("/cap/alert/")+a.message},error:function(a,b,
d){console.log("UNAUTHORIZED"==d?i18n.gis_requires_login:a.responseText)},type:"POST",dataType:"json"})};window.fields=h;a(document).ready(function(){a("form").each(function(){""!==b(a(this))&&(p(a(this)),(0<a(".cap_template_form").length||f())&&r(a(this)))});u()})})(jQuery,JSON,void 0);
