/*
 2013-2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3

 2015-2019 (c) Sahana Software Foundation
 @license MIT

 requires jQuery 1.9.1+
 requires jQuery UI 1.10 widget factory
 requires jQuery jstree 3.0.3
 jsTree 3.3.8
 http://jstree.com/

 Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)

 Licensed same as jquery - under the terms of the MIT License
   http://www.opensource.org/licenses/mit-license.php
 if using jslint please allow for the jQuery global and use following options:
 jslint: loopfunc: true, browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 'themes' : {
      'name' : this.get_theme(),
      'icons' : this._data.core.themes.icons,
      'dots' : this._data.core.themes.dots
     },
 oi = obj.children("i:visible"),
   ai = a.children("i:visible"),
   w1 = oi.width() * oi.length,
   w2 = ai.width() * ai.length,
 "shortcut"			: 113,
     "shortcut_label"	: 'F2',
     "icon"				: "glyphicon glyphicon-leaf",
 if(!('oncontextmenu' in document.body) && ('ontouchstart' in document.body)) {
    var el = null, tm = null;
    this.element
     .on("touchstart", ".jstree-anchor", function (e) {
      el = e.currentTarget;
      tm = +new Date();
      $(document).one("touchend", function (e) {
       e.target = document.elementFromPoint(e.originalEvent.targetTouches[0].pageX - window.pageXOffset, e.originalEvent.targetTouches[0].pageY - window.pageYOffset);
       e.currentTarget = e.target;
       tm = ((+(new Date())) - tm);
       if(e.target === el && tm > 600 && tm < 1000) {
        e.preventDefault();
        $(el).trigger('contextmenu', e);
       }
       el = null;
       tm = null;
      });
     });
   }
 .on("mousedown.jstree touchstart.jstree", ".jstree-wholerow", function (e) {
      if(e.target === e.currentTarget) {
       var a = $(e.currentTarget).closest(".jstree-node").children(".jstree-anchor");
       e.target = a[0];
       a.trigger(e);
      }
     })
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,q,x){d instanceof String&&(d=String(d));for(var f=d.length,l=0;l<f;l++){var n=d[l];if(q.call(x,n,l,d))return{i:l,v:n}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,q,x){d!=Array.prototype&&d!=Object.prototype&&(d[q]=x.value)};$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,d];for(var q=0;q<d.length;++q){var x=d[q];if(x&&x.Math==Math)return x}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,q,x,f){if(q){x=$jscomp.global;d=d.split(".");for(f=0;f<d.length-1;f++){var l=d[f];l in x||(x[l]={});x=x[l]}d=d[d.length-1];f=x[d];q=q(f);q!=f&&null!=q&&$jscomp.defineProperty(x,d,{configurable:!0,writable:!0,value:q})}};$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,x){return $jscomp.findInternal(this,d,x).v}},"es6","es3");
(function(d){"function"===typeof define&&define.amd?define(["jquery"],d):"undefined"!==typeof module&&module.exports?module.exports=d(require("jquery")):d(jQuery)})(function(d,q){if(!d.jstree){var x=0,f=!1,l=!1,n=!1,w=[],y=d("script:last").attr("src"),t=window.document;d.jstree={version:"3.3.8",defaults:{plugins:[]},plugins:{},path:y&&-1!==y.indexOf("/")?y.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g,root:"#"};d.jstree.create=function(a,b){var c=new d.jstree.core(++x),
e=b;b=d.extend(!0,{},d.jstree.defaults,b);e&&e.plugins&&(b.plugins=e.plugins);d.each(b.plugins,function(a,e){"core"!==a&&(c=c.plugin(e,b[e]))});d(a).data("jstree",c);c.init(a,b);return c};d.jstree.destroy=function(){d(".jstree:jstree").jstree("destroy");d(t).off(".jstree")};d.jstree.core=function(a){this._id=a;this._cnt=0;this._wrk=null;this._data={core:{themes:{name:!1,dots:!1,icons:!1,ellipsis:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}};d.jstree.reference=function(a){var b=
null,c=null;!a||!a.id||a.tagName&&a.nodeType||(a=a.id);if(!c||!c.length)try{c=d(a)}catch(e){}if(!c||!c.length)try{c=d("#"+a.replace(d.jstree.idregex,"\\$&"))}catch(e){}c&&c.length&&(c=c.closest(".jstree")).length&&(c=c.data("jstree"))?b=c:d(".jstree").each(function(){var c=d(this).data("jstree");if(c&&c._model.data[a])return b=c,!1});return b};d.fn.jstree=function(a){var b="string"===typeof a,c=Array.prototype.slice.call(arguments,1),e=null;if(!0===a&&!this.length)return!1;this.each(function(){var h=
d.jstree.reference(this),k=b&&h?h[a]:null;e=b&&k?k.apply(h,c):null;h||b||a!==q&&!d.isPlainObject(a)||d.jstree.create(this,a);if(h&&!b||!0===a)e=h||!1;if(null!==e&&e!==q)return!1});return null!==e&&e!==q?e:this};d.expr.pseudos.jstree=d.expr.createPseudo(function(a){return function(a){return d(a).hasClass("jstree")&&d(a).data("jstree")!==q}});d.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:d.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,ellipsis:!1,
stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0,loaded_state:!1,restore_focus:!0,keyboard:{"ctrl-space":function(a){a.type="click";d(a.currentTarget).trigger(a)},enter:function(a){a.type="click";d(a.currentTarget).trigger(a)},left:function(a){a.preventDefault();this.is_open(a.currentTarget)?this.close_node(a.currentTarget):(a=this.get_parent(a.currentTarget))&&a.id!==d.jstree.root&&this.get_node(a,!0).children(".jstree-anchor").focus()},up:function(a){a.preventDefault();
(a=this.get_prev_dom(a.currentTarget))&&a.length&&a.children(".jstree-anchor").focus()},right:function(a){a.preventDefault();this.is_closed(a.currentTarget)?this.open_node(a.currentTarget,function(a){this.get_node(a,!0).children(".jstree-anchor").focus()}):this.is_open(a.currentTarget)&&(a=this.get_node(a.currentTarget,!0).children(".jstree-children")[0])&&d(this._firstChild(a)).children(".jstree-anchor").focus()},down:function(a){a.preventDefault();(a=this.get_next_dom(a.currentTarget))&&a.length&&
a.children(".jstree-anchor").focus()},"*":function(a){this.open_all()},home:function(a){a.preventDefault();(a=this._firstChild(this.get_container_ul()[0]))&&d(a).children(".jstree-anchor").filter(":visible").focus()},end:function(a){a.preventDefault();this.element.find(".jstree-anchor").filter(":visible").last().focus()},f2:function(a){a.preventDefault();this.edit(a.currentTarget)}}};d.jstree.core.prototype={plugin:function(a,b){var c=d.jstree.plugins[a];return c?(this._data[a]={},c.prototype=this,
new c(b,this)):this},init:function(a,b){this._model={data:{},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}};this._model.data[d.jstree.root]={id:d.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this.element=d(a).addClass("jstree jstree-"+this._id);this.settings=b;this._data.core.ready=!1;this._data.core.loaded=!1;this._data.core.rtl="rtl"===this.element.css("direction");this.element[this._data.core.rtl?
"addClass":"removeClass"]("jstree-rtl");this.element.attr("role","tree");this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0);this.element.attr("tabindex")||this.element.attr("tabindex","0");this.bind();this.trigger("init");this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0);this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove();
this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>");this.element.attr("aria-activedescendant","j"+this._id+"_loading");this._data.core.li_height=this.get_container_ul().children("li").first().outerHeight()||
24;this._data.core.node=this._create_prototype_node();this.trigger("loading");this.load_node(d.jstree.root)},destroy:function(a){this.trigger("destroy");if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(b){}a||this.element.empty();this.teardown()},_create_prototype_node:function(){var a=t.createElement("LI");a.setAttribute("role","treeitem");var b=t.createElement("I");b.className="jstree-icon jstree-ocl";b.setAttribute("role","presentation");a.appendChild(b);b=t.createElement("A");
b.className="jstree-anchor";b.setAttribute("href","#");b.setAttribute("tabindex","-1");var c=t.createElement("I");c.className="jstree-icon jstree-themeicon";c.setAttribute("role","presentation");b.appendChild(c);a.appendChild(b);return a},_kbevent_to_func:function(a){var b=[];a.ctrlKey&&b.push("ctrl");a.altKey&&b.push("alt");a.shiftKey&&b.push("shift");b.push({8:"Backspace",9:"Tab",13:"Enter",19:"Pause",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",
40:"Down",44:"Print",45:"Insert",46:"Delete",96:"Numpad0",97:"Numpad1",98:"Numpad2",99:"Numpad3",100:"Numpad4",101:"Numpad5",102:"Numpad6",103:"Numpad7",104:"Numpad8",105:"Numpad9","-13":"NumpadEnter",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"Numlock",145:"Scrolllock",16:"Shift",17:"Ctrl",18:"Alt",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",
72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",111:"/",106:"*",173:"-"}[a.which]||a.which);b=b.sort().join("-").toLowerCase();a=this.settings.core.keyboard;var c;for(c in a)if(a.hasOwnProperty(c)){var e=c;"-"!==e&&"+"!==e&&(e=e.replace("--","-MINUS").replace("+-","-MINUS").replace("++","-PLUS").replace("-+",
"-PLUS"),e=e.split(/-|\+/).sort().join("-").replace("MINUS","-").replace("PLUS","+").toLowerCase());if(e===b)return a[c]}return null},teardown:function(){this.unbind();this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/ig,"")});this.element=null},bind:function(){var a="",b=null,c=0;this.element.on("dblclick.jstree",function(a){if(a.target.tagName&&"input"===a.target.tagName.toLowerCase())return!0;
if(t.selection&&t.selection.empty)t.selection.empty();else if(window.getSelection){a=window.getSelection();try{a.removeAllRanges(),a.collapse()}catch(h){}}}).on("mousedown.jstree",d.proxy(function(a){a.target===this.element[0]&&(a.preventDefault(),c=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(a){a.preventDefault()}).on("click.jstree",".jstree-ocl",d.proxy(function(a){this.toggle_node(a.target)},this)).on("dblclick.jstree",".jstree-anchor",d.proxy(function(a){if(a.target.tagName&&
"input"===a.target.tagName.toLowerCase())return!0;this.settings.core.dblclick_toggle&&this.toggle_node(a.target)},this)).on("click.jstree",".jstree-anchor",d.proxy(function(a){a.preventDefault();a.currentTarget!==t.activeElement&&d(a.currentTarget).focus();this.activate_node(a.currentTarget,a)},this)).on("keydown.jstree",".jstree-anchor",d.proxy(function(a){if(a.target.tagName&&"input"===a.target.tagName.toLowerCase())return!0;this._data.core.rtl&&(37===a.which?a.which=39:39===a.which&&(a.which=37));
var c=this._kbevent_to_func(a);if(c&&(a=c.call(this,a),!1===a||!0===a))return a},this)).on("load_node.jstree",d.proxy(function(a,c){c.status&&(c.node.id!==d.jstree.root||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(d.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){this._data.core.ready=
!0;if(this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var a=[],c;var b=0;for(c=this._data.core.selected.length;b<c;b++)a=a.concat(this._model.data[this._data.core.selected[b]].parents);a=d.vakata.array_unique(a);b=0;for(c=a.length;b<c;b++)this.open_node(a[b],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",d.proxy(function(c){if(c.target.tagName&&"input"===c.target.tagName.toLowerCase())return!0;
b&&clearTimeout(b);b=setTimeout(function(){a=""},500);var e=String.fromCharCode(c.which).toLowerCase();c=this.element.find(".jstree-anchor").filter(":visible");var k=c.index(t.activeElement)||0,g=!1;a+=e;if(1<a.length){c.slice(k).each(d.proxy(function(c,b){if(0===d(b).text().toLowerCase().indexOf(a))return d(b).focus(),g=!0,!1},this));if(g)return;c.slice(0,k).each(d.proxy(function(c,b){if(0===d(b).text().toLowerCase().indexOf(a))return d(b).focus(),g=!0,!1},this));if(g)return}(new RegExp("^"+e.replace(/[-\/\\^$*+?.()|[\]{}]/g,
"\\$&")+"+$")).test(a)&&(c.slice(k+1).each(d.proxy(function(a,c){if(d(c).text().toLowerCase().charAt(0)===e)return d(c).focus(),g=!0,!1},this)),g||c.slice(0,k+1).each(d.proxy(function(a,c){if(d(c).text().toLowerCase().charAt(0)===e)return d(c).focus(),g=!0,!1},this)))},this)).on("init.jstree",d.proxy(function(){var a=this.settings.core.themes;this._data.core.themes.dots=a.dots;this._data.core.themes.stripes=a.stripes;this._data.core.themes.icons=a.icons;this._data.core.themes.ellipsis=a.ellipsis;
this.set_theme(a.name||"default",a.url);this.set_theme_variant(a.variant)},this)).on("loading.jstree",d.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"]();this[this._data.core.themes.icons?"show_icons":"hide_icons"]();this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]();this[this._data.core.themes.ellipsis?"show_ellipsis":"hide_ellipsis"]()},this)).on("blur.jstree",".jstree-anchor",d.proxy(function(a){this._data.core.focused=null;d(a.currentTarget).filter(".jstree-hovered").trigger("mouseleave");
this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",d.proxy(function(a){var c=this.get_node(a.currentTarget);c&&c.id&&(this._data.core.focused=c.id);this.element.find(".jstree-hovered").not(a.currentTarget).trigger("mouseleave");d(a.currentTarget).trigger("mouseenter");this.element.attr("tabindex","-1")},this)).on("focus.jstree",d.proxy(function(){if(500<+new Date-c&&!this._data.core.focused&&this.settings.core.restore_focus){c=0;var a=this.get_node(this.element.attr("aria-activedescendant"),
!0);a&&a.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",d.proxy(function(a){this.hover_node(a.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))},unbind:function(){this.element.off(".jstree");d(t).off(".jstree-"+this._id)},trigger:function(a,b){b||(b={});b.instance=this;this.element.triggerHandler(a.replace(".jstree","")+".jstree",b)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},
get_string:function(a){var b=this.settings.core.strings;return d.isFunction(b)?b.call(this,a):b&&b[a]?b[a]:a},_firstChild:function(a){for(a=a?a.firstChild:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_nextSibling:function(a){for(a=a?a.nextSibling:null;null!==a&&1!==a.nodeType;)a=a.nextSibling;return a},_previousSibling:function(a){for(a=a?a.previousSibling:null;null!==a&&1!==a.nodeType;)a=a.previousSibling;return a},get_node:function(a,b){a&&a.id&&(a=a.id);a instanceof d&&a.length&&a[0].id&&
(a=a[0].id);var c;try{if(this._model.data[a])a=this._model.data[a];else if("string"===typeof a&&this._model.data[a.replace(/^#/,"")])a=this._model.data[a.replace(/^#/,"")];else if("string"===typeof a&&(c=d("#"+a.replace(d.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[c.closest(".jstree-node").attr("id")])a=this._model.data[c.closest(".jstree-node").attr("id")];else if((c=this.element.find(a)).length&&this._model.data[c.closest(".jstree-node").attr("id")])a=this._model.data[c.closest(".jstree-node").attr("id")];
else if((c=this.element.find(a)).length&&c.hasClass("jstree"))a=this._model.data[d.jstree.root];else return!1;b&&(a=a.id===d.jstree.root?this.element:d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element));return a}catch(e){return!1}},get_path:function(a,b,c){a=a.parents?a:this.get_node(a);if(!a||a.id===d.jstree.root||!a.parents)return!1;var e,h=[];h.push(c?a.id:a.text);var k=0;for(e=a.parents.length;k<e;k++)h.push(c?a.parents[k]:this.get_text(a.parents[k]));h=h.reverse().slice(1);return b?h.join(b):
h},get_next_dom:function(a,b){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this._firstChild(this.get_container_ul()[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;if(b){b=a[0];do b=this._nextSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}if(a.hasClass("jstree-open")){for(b=this._firstChild(a.children(".jstree-children")[0]);b&&0===b.offsetHeight;)b=this._nextSibling(b);if(null!==b)return d(b)}b=a[0];do b=this._nextSibling(b);while(b&&
0===b.offsetHeight);return null!==b?d(b):a.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(a,b){a=this.get_node(a,!0);if(a[0]===this.element[0]){for(b=this.get_container_ul()[0].lastChild;b&&0===b.offsetHeight;)b=this._previousSibling(b);return b?d(b):!1}if(!a||!a.length)return!1;if(b){b=a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);return b?d(b):!1}b=a[0];do b=this._previousSibling(b);while(b&&0===b.offsetHeight);if(null!==b){for(a=
d(b);a.hasClass("jstree-open");)a=a.children(".jstree-children").first().children(".jstree-node:visible:last");return a}return(b=a[0].parentNode.parentNode)&&b.className&&-1!==b.className.indexOf("jstree-node")?d(b):!1},get_parent:function(a){return(a=this.get_node(a))&&a.id!==d.jstree.root?a.parent:!1},get_children_dom:function(a){a=this.get_node(a,!0);return a[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):a&&a.length?a.children(".jstree-children").children(".jstree-node"):
!1},is_parent:function(a){return(a=this.get_node(a))&&(!1===a.state.loaded||0<a.children.length)},is_loaded:function(a){return(a=this.get_node(a))&&a.state.loaded},is_loading:function(a){return(a=this.get_node(a))&&a.state&&a.state.loading},is_open:function(a){return(a=this.get_node(a))&&a.state.opened},is_closed:function(a){return(a=this.get_node(a))&&this.is_parent(a)&&!a.state.opened},is_leaf:function(a){return!this.is_parent(a)},load_node:function(a,b){var c,e;if(d.isArray(a))return this._load_nodes(a.slice(),
b),!0;a=this.get_node(a);if(!a)return b&&b.call(this,a,!1),!1;if(a.state.loaded){a.state.loaded=!1;var h=0;for(c=a.parents.length;h<c;h++)this._model.data[a.parents[h]].children_d=d.vakata.array_filter(this._model.data[a.parents[h]].children_d,function(c){return-1===d.inArray(c,a.children_d)});h=0;for(c=a.children_d.length;h<c;h++)this._model.data[a.children_d[h]].state.selected&&(e=!0),delete this._model.data[a.children_d[h]];e&&(this._data.core.selected=d.vakata.array_filter(this._data.core.selected,
function(c){return-1===d.inArray(c,a.children_d)}));a.children=[];a.children_d=[];e&&this.trigger("changed",{action:"load_node",node:a,selected:this._data.core.selected})}a.state.failed=!1;a.state.loading=!0;this.get_node(a,!0).addClass("jstree-loading").attr("aria-busy",!0);this._load_node(a,d.proxy(function(c){a=this._model.data[a.id];a.state.loading=!1;a.state.loaded=c;a.state.failed=!a.state.loaded;var e=this.get_node(a,!0),h,d=this._model.data,k=!1;var r=0;for(h=a.children.length;r<h;r++)if(d[a.children[r]]&&
!d[a.children[r]].state.hidden){k=!0;break}a.state.loaded&&e&&e.length&&(e.removeClass("jstree-closed jstree-open jstree-leaf"),k?"#"!==a.id&&e.addClass(a.state.opened?"jstree-open":"jstree-closed"):e.addClass("jstree-leaf"));e.removeClass("jstree-loading").attr("aria-busy",!1);this.trigger("load_node",{node:a,status:c});b&&b.call(this,a,c)},this));return!0},_load_nodes:function(a,b,c,e){var h=!0,d=function(){this._load_nodes(a,b,!0)},g=this._model.data,m,p=[];var v=0;for(m=a.length;v<m;v++)g[a[v]]&&
(!g[a[v]].state.loaded&&!g[a[v]].state.failed||!c&&e)&&(this.is_loading(a[v])||this.load_node(a[v],d),h=!1);if(h){v=0;for(m=a.length;v<m;v++)g[a[v]]&&g[a[v]].state.loaded&&p.push(a[v]);b&&!b.done&&(b.call(this,p),b.done=!0)}},load_all:function(a,b){a||(a=d.jstree.root);a=this.get_node(a);if(!a)return!1;var c=[],e=this._model.data,h=e[a.id].children_d,k;a.state&&!a.state.loaded&&c.push(a.id);var g=0;for(k=h.length;g<k;g++)e[h[g]]&&e[h[g]].state&&!e[h[g]].state.loaded&&c.push(h[g]);c.length?this._load_nodes(c,
function(){this.load_all(a,b)}):(b&&b.call(this,a),this.trigger("load_all",{node:a}))},_load_node:function(a,b){var c=this.settings.core.data,e=function(){return 3!==this.nodeType&&8!==this.nodeType};if(!c)return a.id===d.jstree.root?this._append_html_data(a,this._data.core.original_container_html.clone(!0),function(a){b.call(this,a)}):b.call(this,!1);if(d.isFunction(c))return c.call(this,a,d.proxy(function(c){if(!1===c)b.call(this,!1);else this["string"===typeof c?"_append_html_data":"_append_json_data"](a,
"string"===typeof c?d(d.parseHTML(c)).filter(e):c,function(a){b.call(this,a)})},this));if("object"===typeof c){if(c.url)return c=d.extend(!0,{},c),d.isFunction(c.url)&&(c.url=c.url.call(this,a)),d.isFunction(c.data)&&(c.data=c.data.call(this,a)),d.ajax(c).done(d.proxy(function(c,k,g){if((k=g.getResponseHeader("Content-Type"))&&-1!==k.indexOf("json")||"object"===typeof c)return this._append_json_data(a,c,function(a){b.call(this,a)});if(k&&-1!==k.indexOf("html")||"string"===typeof c)return this._append_html_data(a,
d(d.parseHTML(c)).filter(e),function(a){b.call(this,a)});this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:g})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,!1)},this)).fail(d.proxy(function(c){this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:a.id,xhr:c})};b.call(this,!1);this.settings.core.error.call(this,this._data.core.last_error)},
this));c=d.isArray(c)?d.extend(!0,[],c):d.isPlainObject(c)?d.extend(!0,{},c):c;if(a.id===d.jstree.root)return this._append_json_data(a,c,function(a){b.call(this,a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error);return b.call(this,!1)}if("string"===typeof c){if(a.id===d.jstree.root)return this._append_html_data(a,d(d.parseHTML(c)).filter(e),function(a){b.call(this,
a)});this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:a.id})};this.settings.core.error.call(this,this._data.core.last_error)}return b.call(this,!1)},_node_changed:function(a){(a=this.get_node(a))&&-1===d.inArray(a.id,this._model.changed)&&this._model.changed.push(a.id)},_append_html_data:function(a,b,c){a=this.get_node(a);a.children=[];a.children_d=[];b=b.is("ul")?b.children():b;var e=a.id,h=[],k=[],g=this._model.data,m=g[e];
a=this._data.core.selected.length;var p,v;b.each(d.proxy(function(a,c){if(p=this._parse_model_from_html(d(c),e,m.parents.concat()))h.push(p),k.push(p),g[p].children_d.length&&(k=k.concat(g[p].children_d))},this));m.children=h;m.children_d=k;b=0;for(v=m.parents.length;b<v;b++)g[m.parents[b]].children_d=g[m.parents[b]].children_d.concat(k);this.trigger("model",{nodes:k,parent:e});e!==d.jstree.root?(this._node_changed(e),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),
this.redraw(!0));this._data.core.selected.length!==a&&this.trigger("changed",{action:"model",selected:this._data.core.selected});c.call(this,!0)},_append_json_data:function(a,b,c,e){if(null!==this.element){a=this.get_node(a);a.children=[];a.children_d=[];b.d&&(b=b.d,"string"===typeof b&&(b=JSON.parse(b)));d.isArray(b)||(b=[b]);var h=null,k={df:this._model.default_state,dat:b,par:a.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},g=this,m=function(a,c){a.data&&(a=a.data);
var b=a.dat,e=a.par,d=[],h=[],k=[],m=a.df,p=a.t_id,v=a.t_cnt,r=a.m,f=r[e];a=a.sel;var l,n=function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);var h=a.id.toString();b={id:h,text:a.text||"",icon:a.icon!==c?a.icon:!0,parent:b,parents:e,children:a.children||[],children_d:a.children_d||[],data:a.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(d in m)m.hasOwnProperty(d)&&(b.state[d]=m[d]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(b.icon===c||null===b.icon||
""===b.icon)b.icon=!0;if(a&&a.data&&(b.data=a.data,a.data.jstree))for(d in a.data.jstree)a.data.jstree.hasOwnProperty(d)&&(b.state[d]=a.data.jstree[d]);if(a&&"object"===typeof a.state)for(d in a.state)a.state.hasOwnProperty(d)&&(b.state[d]=a.state[d]);if(a&&"object"===typeof a.li_attr)for(d in a.li_attr)a.li_attr.hasOwnProperty(d)&&(b.li_attr[d]=a.li_attr[d]);b.li_attr.id||(b.li_attr.id=h);if(a&&"object"===typeof a.a_attr)for(d in a.a_attr)a.a_attr.hasOwnProperty(d)&&(b.a_attr[d]=a.a_attr[d]);a&&
a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);r[b.id]=b;var d=0;for(h=b.children.length;d<h;d++){var g=n(r[b.children[d]],b.id,e);var p=r[g];b.children_d.push(g);p.children_d.length&&(b.children_d=b.children_d.concat(p.children_d))}delete a.data;delete a.children;r[b.id].original=a;b.state.selected&&k.push(b.id);return b.id},t=function(a,b,e){e=e?e.concat():[];b&&e.unshift(b);do var d="j"+p+"_"+ ++v;while(r[d]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===
typeof a&&a.icon!==c?a.icon:!0,parent:b,parents:e,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(h in m)m.hasOwnProperty(h)&&(b.state[h]=m[h]);a&&a.id&&(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(b.icon===c||null===b.icon||""===b.icon)b.icon=!0;if(a&&a.data&&(b.data=a.data,a.data.jstree))for(h in a.data.jstree)a.data.jstree.hasOwnProperty(h)&&(b.state[h]=a.data.jstree[h]);
if(a&&"object"===typeof a.state)for(h in a.state)a.state.hasOwnProperty(h)&&(b.state[h]=a.state[h]);if(a&&"object"===typeof a.li_attr)for(h in a.li_attr)a.li_attr.hasOwnProperty(h)&&(b.li_attr[h]=a.li_attr[h]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=d);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(h in a.a_attr)a.a_attr.hasOwnProperty(h)&&(b.a_attr[h]=a.a_attr[h]);if(a&&a.children&&a.children.length){var h=0;for(d=a.children.length;h<d;h++){var g=t(a.children[h],
b.id,e);var A=r[g];b.children.push(g);A.children_d.length&&(b.children_d=b.children_d.concat(A.children_d))}b.children_d=b.children_d.concat(b.children)}a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;r[b.id]=b;b.state.selected&&k.push(b.id);return b.id};if(b.length&&b[0].id!==c&&b[0].parent!==c){var q=0;for(l=b.length;q<l;q++)b[q].children||(b[q].children=[]),b[q].state||(b[q].state={}),r[b[q].id.toString()]=b[q];q=0;
for(l=b.length;q<l;q++)r[b[q].parent.toString()]?(r[b[q].parent.toString()].children.push(b[q].id.toString()),f.children_d.push(b[q].id.toString())):"undefined"!==typeof g&&(g._data.core.last_error={error:"parse",plugin:"core",id:"core_07",reason:"Node with invalid parent",data:JSON.stringify({id:b[q].id.toString(),parent:b[q].parent.toString()})},g.settings.core.error.call(g,g._data.core.last_error));q=0;for(l=f.children.length;q<l;q++){var w=n(r[f.children[q]],e,f.parents.concat());h.push(w);r[w].children_d.length&&
(h=h.concat(r[w].children_d))}}else{q=0;for(l=b.length;q<l;q++)if(w=t(b[q],e,f.parents.concat()))d.push(w),h.push(w),r[w].children_d.length&&(h=h.concat(r[w].children_d));f.children=d;f.children_d=h}q=0;for(l=f.parents.length;q<l;q++)r[f.parents[q]].children_d=r[f.parents[q]].children_d.concat(h);b={cnt:v,mod:r,sel:a,par:e,dpc:h,add:k};if("undefined"===typeof window||"undefined"===typeof window.document)postMessage(b);else return b},p=function(a,b){if(null!==this.element){this._cnt=a.cnt;var e=this._model.data;
for(m in e)e.hasOwnProperty(m)&&e[m].state&&e[m].state.loading&&a.mod[m]&&(a.mod[m].state.loading=!0);this._model.data=a.mod;if(b){var h=a.add,g=a.sel,k=this._data.core.selected.slice();e=this._model.data;if(g.length!==k.length||d.vakata.array_unique(g.concat(k)).length!==g.length){var m=0;for(b=g.length;m<b;m++)-1===d.inArray(g[m],h)&&-1===d.inArray(g[m],k)&&(e[g[m]].state.selected=!1);m=0;for(b=k.length;m<b;m++)-1===d.inArray(k[m],g)&&(e[k[m]].state.selected=!0)}}a.add.length&&(this._data.core.selected=
this._data.core.selected.concat(a.add));this.trigger("model",{nodes:a.dpc,parent:a.par});a.par!==d.jstree.root?(this._node_changed(a.par),this.redraw()):this.redraw(!0);a.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected});c.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+m.toString()],{type:"text/javascript"}))),!this._data.core.working||
e?(this._data.core.working=!0,h=new window.Worker(this._wrk),h.onmessage=d.proxy(function(a){p.call(this,a.data,!0);try{h.terminate(),h=null}catch(r){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),k.par?h.postMessage(k):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([a,b,c,!0])}catch(v){p.call(this,
m(k),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else p.call(this,m(k),!1)}},_parse_model_from_html:function(a,b,c){c=c?[].concat(c):[];b&&c.unshift(b);var e,h,k=this._model.data,g={id:!1,text:!1,icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(m in this._model.default_state)this._model.default_state.hasOwnProperty(m)&&(g.state[m]=
this._model.default_state[m]);b=d.vakata.attributes(a,!0);d.each(b,function(a,c){c=d.trim(c);if(!c.length)return!0;g.li_attr[a]=c;"id"===a&&(g.id=c.toString())});b=a.children("a").first();b.length&&(b=d.vakata.attributes(b,!0),d.each(b,function(a,c){c=d.trim(c);c.length&&(g.a_attr[a]=c)}));b=a.children("a").first().length?a.children("a").first().clone():a.clone();b.children("ins, i, ul").remove();b=b.html();b=d("<div />").html(b);g.text=this.settings.core.force_text?b.text():b.html();b=a.data();g.data=
b?d.extend(!0,{},b):null;g.state.opened=a.hasClass("jstree-open");g.state.selected=a.children("a").hasClass("jstree-clicked");g.state.disabled=a.children("a").hasClass("jstree-disabled");if(g.data&&g.data.jstree)for(m in g.data.jstree)g.data.jstree.hasOwnProperty(m)&&(g.state[m]=g.data.jstree[m]);b=a.children("a").children(".jstree-themeicon");b.length&&(g.icon=b.hasClass("jstree-themeicon-hidden")?!1:b.attr("rel"));g.state.icon!==q&&(g.icon=g.state.icon);if(g.icon===q||null===g.icon||""===g.icon)g.icon=
!0;b=a.children("ul").children("li");do var m="j"+this._id+"_"+ ++this._cnt;while(k[m]);g.id=g.li_attr.id?g.li_attr.id.toString():m;b.length?(b.each(d.proxy(function(a,b){e=this._parse_model_from_html(d(b),g.id,c);h=this._model.data[e];g.children.push(e);h.children_d.length&&(g.children_d=g.children_d.concat(h.children_d))},this)),g.children_d=g.children_d.concat(g.children)):a.hasClass("jstree-closed")&&(g.state.loaded=!1);g.li_attr["class"]&&(g.li_attr["class"]=g.li_attr["class"].replace("jstree-closed",
"").replace("jstree-open",""));g.a_attr["class"]&&(g.a_attr["class"]=g.a_attr["class"].replace("jstree-clicked","").replace("jstree-disabled",""));k[g.id]=g;g.state.selected&&this._data.core.selected.push(g.id);return g.id},_parse_model_from_flat_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var e=a.id.toString(),h=this._model.data,d=this._model.default_state;b={id:e,text:a.text||"",icon:a.icon!==q?a.icon:!0,parent:b,parents:c,children:a.children||[],children_d:a.children_d||[],data:a.data,
state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in d)d.hasOwnProperty(g)&&(b.state[g]=d[g]);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(b.icon===q||null===b.icon||""===b.icon)b.icon=!0;if(a&&a.data&&(b.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(b.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(b.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&
(b.li_attr[g]=a.li_attr[g]);b.li_attr.id||(b.li_attr.id=e);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(b.a_attr[g]=a.a_attr[g]);a&&a.children&&!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);h[b.id]=b;var g=0;for(e=b.children.length;g<e;g++){d=this._parse_model_from_flat_json(h[b.children[g]],b.id,c);var m=h[d];b.children_d.push(d);m.children_d.length&&(b.children_d=b.children_d.concat(m.children_d))}delete a.data;delete a.children;h[b.id].original=
a;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_parse_model_from_json:function(a,b,c){c=c?c.concat():[];b&&c.unshift(b);var e=this._model.data;var h=this._model.default_state;do var d="j"+this._id+"_"+ ++this._cnt;while(e[d]);b={id:!1,text:"string"===typeof a?a:"",icon:"object"===typeof a&&a.icon!==q?a.icon:!0,parent:b,parents:c,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(g in h)h.hasOwnProperty(g)&&(b.state[g]=h[g]);a&&a.id&&
(b.id=a.id.toString());a&&a.text&&(b.text=a.text);a&&a.data&&a.data.jstree&&a.data.jstree.icon&&(b.icon=a.data.jstree.icon);if(b.icon===q||null===b.icon||""===b.icon)b.icon=!0;if(a&&a.data&&(b.data=a.data,a.data.jstree))for(g in a.data.jstree)a.data.jstree.hasOwnProperty(g)&&(b.state[g]=a.data.jstree[g]);if(a&&"object"===typeof a.state)for(g in a.state)a.state.hasOwnProperty(g)&&(b.state[g]=a.state[g]);if(a&&"object"===typeof a.li_attr)for(g in a.li_attr)a.li_attr.hasOwnProperty(g)&&(b.li_attr[g]=
a.li_attr[g]);b.li_attr.id&&!b.id&&(b.id=b.li_attr.id.toString());b.id||(b.id=d);b.li_attr.id||(b.li_attr.id=b.id);if(a&&"object"===typeof a.a_attr)for(g in a.a_attr)a.a_attr.hasOwnProperty(g)&&(b.a_attr[g]=a.a_attr[g]);if(a&&a.children&&a.children.length){var g=0;for(d=a.children.length;g<d;g++){h=this._parse_model_from_json(a.children[g],b.id,c);var m=e[h];b.children.push(h);m.children_d.length&&(b.children_d=b.children_d.concat(m.children_d))}b.children_d=b.children.concat(b.children_d)}a&&a.children&&
!0===a.children&&(b.state.loaded=!1,b.children=[],b.children_d=[]);delete a.data;delete a.children;b.original=a;e[b.id]=b;b.state.selected&&this._data.core.selected.push(b.id);return b.id},_redraw:function(){var a=this._model.force_full_redraw?this._model.data[d.jstree.root].children.concat([]):this._model.changed.concat([]),b=t.createElement("UL"),c,e,h=this._data.core.focused;var k=0;for(e=a.length;k<e;k++)(c=this.redraw_node(a[k],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&
b.appendChild(c);this._model.force_full_redraw&&(b.className=this.get_container_ul()[0].className,b.setAttribute("role","group"),this.element.empty().append(b));null!==h&&this.settings.core.restore_focus&&((c=this.get_node(h,!0))&&c.length&&c.children(".jstree-anchor")[0]!==t.activeElement?c.children(".jstree-anchor").focus():this._data.core.focused=null);this._model.force_full_redraw=!1;this._model.changed=[];this.trigger("redraw",{nodes:a})},redraw:function(a){a&&(this._model.force_full_redraw=
!0);this._redraw()},draw_children:function(a){var b=this.get_node(a),c;if(!b)return!1;if(b.id===d.jstree.root)return this.redraw(!0);a=this.get_node(a,!0);if(!a||!a.length)return!1;a.children(".jstree-children").remove();a=a[0];if(b.children.length&&b.state.loaded){var e=t.createElement("UL");e.setAttribute("role","group");e.className="jstree-children";var h=0;for(c=b.children.length;h<c;h++)e.appendChild(this.redraw_node(b.children[h],!0,!0));a.appendChild(e)}},redraw_node:function(a,b,c,e){var h=
this.get_node(a),k=!1,g=!1,m=!1,p=!1,v=!1,r=!1,f="";r=this._model.data;var u=!1,l=null;f=v=0;var q=!1,A=!1;if(!h)return!1;if(h.id===d.jstree.root)return this.redraw(!0);b=b||0===h.children.length;if(a=t.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(h.id[0])?"\\3"+h.id[0]+" "+h.id.substr(1).replace(d.jstree.idregex,"\\$&"):h.id.replace(d.jstree.idregex,"\\$&"))):t.getElementById(h.id))a=d(a),c||(k=a.parent().parent()[0],k===this.element[0]&&(k=null),g=a.index()),b||!h.children.length||
a.children(".jstree-children").length||(b=!0),b||(m=a.children(".jstree-children")[0]),u=a.children(".jstree-anchor")[0]===t.activeElement,a.remove();else if(b=!0,!c){k=h.parent!==d.jstree.root?d("#"+h.parent.replace(d.jstree.idregex,"\\$&"),this.element)[0]:null;if(!(null===k||k&&r[h.parent].state.opened))return!1;g=d.inArray(h.id,null===k?r[d.jstree.root].children:r[h.parent].children)}a=this._data.core.node.cloneNode(!0);f="jstree-node ";for(p in h.li_attr)h.li_attr.hasOwnProperty(p)&&"id"!==p&&
("class"!==p?a.setAttribute(p,h.li_attr[p]):f+=h.li_attr[p]);h.a_attr.id||(h.a_attr.id=h.id+"_anchor");a.setAttribute("aria-selected",!!h.state.selected);a.setAttribute("aria-level",h.parents.length);a.setAttribute("aria-labelledby",h.a_attr.id);h.state.disabled&&a.setAttribute("aria-disabled",!0);p=0;for(v=h.children.length;p<v;p++)if(!r[h.children[p]].state.hidden){q=!0;break}if(null!==h.parent&&r[h.parent]&&!h.state.hidden&&(p=d.inArray(h.id,r[h.parent].children),A=h.id,-1!==p))for(p++,v=r[h.parent].children.length;p<
v&&(r[r[h.parent].children[p]].state.hidden||(A=r[h.parent].children[p]),A===h.id);p++);h.state.hidden&&(f+=" jstree-hidden");h.state.loading&&(f+=" jstree-loading");h.state.loaded&&!q?f+=" jstree-leaf":(f+=h.state.opened&&h.state.loaded?" jstree-open":" jstree-closed",a.setAttribute("aria-expanded",h.state.opened&&h.state.loaded));A===h.id&&(f+=" jstree-last");a.id=h.id;a.className=f;f=(h.state.selected?" jstree-clicked":"")+(h.state.disabled?" jstree-disabled":"");for(v in h.a_attr)!h.a_attr.hasOwnProperty(v)||
"href"===v&&"#"===h.a_attr[v]||("class"!==v?a.childNodes[1].setAttribute(v,h.a_attr[v]):f+=" "+h.a_attr[v]);f.length&&(a.childNodes[1].className="jstree-anchor "+f);if(h.icon&&!0!==h.icon||!1===h.icon)!1===h.icon?a.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===h.icon.indexOf("/")&&-1===h.icon.indexOf(".")?a.childNodes[1].childNodes[0].className+=" "+h.icon+" jstree-themeicon-custom":(a.childNodes[1].childNodes[0].style.backgroundImage='url("'+h.icon+'")',a.childNodes[1].childNodes[0].style.backgroundPosition=
"center center",a.childNodes[1].childNodes[0].style.backgroundSize="auto",a.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom");this.settings.core.force_text?a.childNodes[1].appendChild(t.createTextNode(h.text)):a.childNodes[1].innerHTML+=h.text;if(b&&h.children.length&&(h.state.opened||e)&&h.state.loaded){r=t.createElement("UL");r.setAttribute("role","group");r.className="jstree-children";p=0;for(v=h.children.length;p<v;p++)r.appendChild(this.redraw_node(h.children[p],b,!0));a.appendChild(r)}m&&
a.appendChild(m);if(!c){k||(k=this.element[0]);p=0;for(v=k.childNodes.length;p<v;p++)if(k.childNodes[p]&&k.childNodes[p].className&&-1!==k.childNodes[p].className.indexOf("jstree-children")){l=k.childNodes[p];break}l||(l=t.createElement("UL"),l.setAttribute("role","group"),l.className="jstree-children",k.appendChild(l));k=l;g<k.childNodes.length?k.insertBefore(a,k.childNodes[g]):k.appendChild(a);u&&(v=this.element[0].scrollTop,f=this.element[0].scrollLeft,a.childNodes[1].focus(),this.element[0].scrollTop=
v,this.element[0].scrollLeft=f)}h.state.opened&&!h.state.loaded&&(h.state.opened=!1,setTimeout(d.proxy(function(){this.open_node(h.id,!1,0)},this),0));return a},open_node:function(a,b,c){var e;if(d.isArray(a)){a=a.slice();var h=0;for(e=a.length;h<e;h++)this.open_node(a[h],b,c);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;c=c===q?this.settings.core.animation:c;if(!this.is_closed(a))return b&&b.call(this,a,!1),!1;if(this.is_loaded(a)){h=this.get_node(a,!0);var k=this;h.length&&(c&&
h.children(".jstree-children").length&&h.children(".jstree-children").stop(!0,!0),a.children.length&&!this._firstChild(h.children(".jstree-children")[0])&&this.draw_children(a),c?(this.trigger("before_open",{node:a}),h.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(c,function(){this.style.display="";k.element&&k.trigger("after_open",{node:a})})):(this.trigger("before_open",
{node:a}),h[0].className=h[0].className.replace("jstree-closed","jstree-open"),h[0].setAttribute("aria-expanded",!0)));a.state.opened=!0;b&&b.call(this,a,!0);h.length||this.trigger("before_open",{node:a});this.trigger("open_node",{node:a});c&&h.length||this.trigger("after_open",{node:a});return!0}if(this.is_loading(a))return setTimeout(d.proxy(function(){this.open_node(a,b,c)},this),500);this.load_node(a,function(a,e){return e?this.open_node(a,b,c):b?b.call(this,a,!1):!1})},_open_to:function(a){a=
this.get_node(a);if(!a||a.id===d.jstree.root)return!1;var b,c=a.parents;var e=0;for(b=c.length;e<b;e+=1)e!==d.jstree.root&&this.open_node(c[e],!1,0);return d("#"+a.id.replace(d.jstree.idregex,"\\$&"),this.element)},close_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.close_node(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root||this.is_closed(a))return!1;b=b===q?this.settings.core.animation:b;var h=this;var k=this.get_node(a,!0);a.state.opened=
!1;this.trigger("close_node",{node:a});k.length?b?k.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(b,function(){this.style.display="";k.children(".jstree-children").remove();h.element&&h.trigger("after_close",{node:a})}):(k[0].className=k[0].className.replace("jstree-open","jstree-closed"),k.attr("aria-expanded",!1).children(".jstree-children").remove(),
this.trigger("after_close",{node:a})):this.trigger("after_close",{node:a})},toggle_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.toggle_node(a[c]);return!0}if(this.is_closed(a))return this.open_node(a);if(this.is_open(a))return this.close_node(a)},open_all:function(a,b,c){a||(a=d.jstree.root);a=this.get_node(a);if(!a)return!1;var e=a.id===d.jstree.root?this.get_container_ul():this.get_node(a,!0),h;if(!e.length){e=0;for(h=a.children_d.length;e<h;e++)this.is_closed(this._model.data[a.children_d[e]])&&
(this._model.data[a.children_d[e]].state.opened=!0);return this.trigger("open_all",{node:a})}c=c||e;var k=this;e=this.is_closed(a)?e.find(".jstree-closed").addBack():e.find(".jstree-closed");e.each(function(){k.open_node(this,function(a,e){e&&this.is_parent(a)&&this.open_all(a,b,c)},b||0)});0===c.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(c)})},close_all:function(a,b){a||(a=d.jstree.root);a=this.get_node(a);if(!a)return!1;var c=a.id===d.jstree.root?this.get_container_ul():
this.get_node(a,!0),e=this,h;c.length&&(c=this.is_open(a)?c.find(".jstree-open").addBack():c.find(".jstree-open"),d(c.get().reverse()).each(function(){e.close_node(this,b||0)}));c=0;for(h=a.children_d.length;c<h;c++)this._model.data[a.children_d[c]].state.opened=!1;this.trigger("close_all",{node:a})},is_disabled:function(a){return(a=this.get_node(a))&&a.state&&a.state.disabled},enable_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.enable_node(a[c]);return!0}a=
this.get_node(a);if(!a||a.id===d.jstree.root)return!1;a.state.disabled=!1;this.get_node(a,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1);this.trigger("enable_node",{node:a})},disable_node:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.disable_node(a[c]);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;a.state.disabled=!0;this.get_node(a,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",
!0);this.trigger("disable_node",{node:a})},is_hidden:function(a){a=this.get_node(a);return!0===a.state.hidden},hide_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.hide_node(a[e],!0);b||this.redraw();return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;a.state.hidden||(a.state.hidden=!0,this._node_changed(a.parent),b||this.redraw(),this.trigger("hide_node",{node:a}))},show_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<
c;e++)this.show_node(a[e],!0);b||this.redraw();return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;a.state.hidden&&(a.state.hidden=!1,this._node_changed(a.parent),b||this.redraw(),this.trigger("show_node",{node:a}))},hide_all:function(a){var b,c=this._model.data,e=[];for(b in c)c.hasOwnProperty(b)&&b!==d.jstree.root&&!c[b].state.hidden&&(c[b].state.hidden=!0,e.push(b));this._model.force_full_redraw=!0;a||this.redraw();this.trigger("hide_all",{nodes:e});return e},show_all:function(a){var b,
c=this._model.data,e=[];for(b in c)c.hasOwnProperty(b)&&b!==d.jstree.root&&c[b].state.hidden&&(c[b].state.hidden=!1,e.push(b));this._model.force_full_redraw=!0;a||this.redraw();this.trigger("show_all",{nodes:e});return e},activate_node:function(a,b){if(this.is_disabled(a))return!1;b&&"object"===typeof b||(b={});this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==q?this.get_node(this._data.core.last_clicked.id):null;this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&
(this._data.core.last_clicked=null);!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1]));if(this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&(!b.shiftKey||this._data.core.last_clicked&&this.get_parent(a)&&this.get_parent(a)===this._data.core.last_clicked.parent))if(b.shiftKey){var c=this.get_node(a).id,e=this._data.core.last_clicked.id,d=this.get_node(this._data.core.last_clicked.parent).children,
k=!1,g;var m=0;for(g=d.length;m<g;m+=1)d[m]===c&&(k=!k),d[m]===e&&(k=!k),this.is_disabled(d[m])||!k&&d[m]!==c&&d[m]!==e?this.deselect_node(d[m],!0,b):this.is_hidden(d[m])||this.select_node(d[m],!0,!1,b);this.trigger("changed",{action:"select_node",node:this.get_node(a),selected:this._data.core.selected,event:b})}else this.is_selected(a)?this.deselect_node(a,!1,b):this.select_node(a,!1,!1,b);else!this.settings.core.multiple&&(b.metaKey||b.ctrlKey||b.shiftKey)&&this.is_selected(a)?this.deselect_node(a,
!1,b):(this.deselect_all(!0),this.select_node(a,!1,!1,b),this._data.core.last_clicked=this.get_node(a));this.trigger("activate_node",{node:this.get_node(a),event:b})},hover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||a.children(".jstree-hovered").length)return!1;var b=this.element.find(".jstree-hovered"),c=this.element;b&&b.length&&this.dehover_node(b);a.children(".jstree-anchor").addClass("jstree-hovered");this.trigger("hover_node",{node:this.get_node(a)});setTimeout(function(){c.attr("aria-activedescendant",
a[0].id)},0)},dehover_node:function(a){a=this.get_node(a,!0);if(!a||!a.length||!a.children(".jstree-hovered").length)return!1;a.children(".jstree-anchor").removeClass("jstree-hovered");this.trigger("dehover_node",{node:this.get_node(a)})},select_node:function(a,b,c,e){var h;if(d.isArray(a)){a=a.slice();var k=0;for(h=a.length;k<h;k++)this.select_node(a[k],b,c,e);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;k=this.get_node(a,!0);a.state.selected||(a.state.selected=!0,this._data.core.selected.push(a.id),
c||(k=this._open_to(a)),k&&k.length&&k.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:a,selected:this._data.core.selected,event:e}),b||this.trigger("changed",{action:"select_node",node:a,selected:this._data.core.selected,event:e}))},deselect_node:function(a,b,c){var e;if(d.isArray(a)){a=a.slice();var h=0;for(e=a.length;h<e;h++)this.deselect_node(a[h],b,c);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;h=this.get_node(a,
!0);a.state.selected&&(a.state.selected=!1,this._data.core.selected=d.vakata.array_remove_item(this._data.core.selected,a.id),h.length&&h.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:a,selected:this._data.core.selected,event:c}),b||this.trigger("changed",{action:"deselect_node",node:a,selected:this._data.core.selected,event:c}))},select_all:function(a){var b=this._data.core.selected.concat([]),c;this._data.core.selected=this._model.data[d.jstree.root].children_d.concat();
var e=0;for(c=this._data.core.selected.length;e<c;e++)this._model.data[this._data.core.selected[e]]&&(this._model.data[this._data.core.selected[e]].state.selected=!0);this.redraw(!0);this.trigger("select_all",{selected:this._data.core.selected});a||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:b})},deselect_all:function(a){var b=this._data.core.selected.concat([]),c;var e=0;for(c=this._data.core.selected.length;e<c;e++)this._model.data[this._data.core.selected[e]]&&
(this._model.data[this._data.core.selected[e]].state.selected=!1);this._data.core.selected=[];this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1);this.trigger("deselect_all",{selected:this._data.core.selected,node:b});a||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:b})},is_selected:function(a){return(a=this.get_node(a))&&a.id!==d.jstree.root?a.state.selected:!1},get_selected:function(a){return a?d.map(this._data.core.selected,
d.proxy(function(a){return this.get_node(a)},this)):this._data.core.selected.slice()},get_top_selected:function(a){var b=this.get_selected(!0),c={},e,h;var k=0;for(e=b.length;k<e;k++)c[b[k].id]=b[k];k=0;for(e=b.length;k<e;k++){var g=0;for(h=b[k].children_d.length;g<h;g++)c[b[k].children_d[g]]&&delete c[b[k].children_d[g]]}b=[];for(k in c)c.hasOwnProperty(k)&&b.push(k);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b},get_bottom_selected:function(a){var b=this.get_selected(!0),
c=[],e;var h=0;for(e=b.length;h<e;h++)b[h].children.length||c.push(b[h].id);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c},get_state:function(){var a={core:{open:[],loaded:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}},b;for(b in this._model.data)this._model.data.hasOwnProperty(b)&&b!==d.jstree.root&&(this._model.data[b].state.loaded&&this.settings.core.loaded_state&&a.core.loaded.push(b),this._model.data[b].state.opened&&a.core.open.push(b),
this._model.data[b].state.selected&&a.core.selected.push(b));return a},set_state:function(a,b){if(a){a.core&&a.core.selected&&a.core.initial_selection===q&&(a.core.initial_selection=this._data.core.selected.concat([]).sort().join(","));if(a.core){var c;if(a.core.loaded)return this.settings.core.loaded_state&&d.isArray(a.core.loaded)&&a.core.loaded.length?this._load_nodes(a.core.loaded,function(c){delete a.core.loaded;this.set_state(a,b)}):(delete a.core.loaded,this.set_state(a,b)),!1;if(a.core.open)return d.isArray(a.core.open)&&
a.core.open.length?this._load_nodes(a.core.open,function(c){this.open_node(c,!1,0);delete a.core.open;this.set_state(a,b)}):(delete a.core.open,this.set_state(a,b)),!1;if(a.core.scroll)return a.core.scroll&&a.core.scroll.left!==q&&this.element.scrollLeft(a.core.scroll.left),a.core.scroll&&a.core.scroll.top!==q&&this.element.scrollTop(a.core.scroll.top),delete a.core.scroll,this.set_state(a,b),!1;if(a.core.selected){var e=this;if(a.core.initial_selection===q||a.core.initial_selection===this._data.core.selected.concat([]).sort().join(","))this.deselect_all(),
d.each(a.core.selected,function(a,c){e.select_node(c,!1,!0)});delete a.core.initial_selection;delete a.core.selected;this.set_state(a,b);return!1}for(c in a)a.hasOwnProperty(c)&&"core"!==c&&-1===d.inArray(c,this.settings.plugins)&&delete a[c];if(d.isEmptyObject(a.core))return delete a.core,this.set_state(a,b),!1}return d.isEmptyObject(a)?(a=null,b&&b.call(this),this.trigger("set_state"),!1):!0}return!1},refresh:function(a,b){this._data.core.state=!0===b?{}:this.get_state();b&&d.isFunction(b)&&(this._data.core.state=
b.call(this,this._data.core.state));this._cnt=0;this._model.data={};this._model.data[d.jstree.root]={id:d.jstree.root,parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}};this._data.core.selected=[];this._data.core.last_clicked=null;this._data.core.focused=null;var c=this.get_container_ul()[0].className;a||(this.element.html("<ul class='"+c+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+
this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"));this.load_node(d.jstree.root,function(a,b){b&&(this.get_container_ul()[0].className=c,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(d.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")}));this._data.core.state=null})},refresh_node:function(a){a=this.get_node(a);
if(!a||a.id===d.jstree.root)return!1;var b=[],c=[],e=this._data.core.selected.concat([]);c.push(a.id);!0===a.state.opened&&b.push(a.id);this.get_node(a,!0).find(".jstree-open").each(function(){c.push(this.id);b.push(this.id)});this._load_nodes(c,d.proxy(function(c){this.open_node(b,!1,0);this.select_node(e);this.trigger("refresh_node",{node:a,nodes:c})},this),!1,!0)},set_id:function(a,b){a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;var c,e=this._model.data,h=a.id;b=b.toString();e[a.parent].children[d.inArray(a.id,
e[a.parent].children)]=b;var k=0;for(c=a.parents.length;k<c;k++)e[a.parents[k]].children_d[d.inArray(a.id,e[a.parents[k]].children_d)]=b;k=0;for(c=a.children.length;k<c;k++)e[a.children[k]].parent=b;k=0;for(c=a.children_d.length;k<c;k++)e[a.children_d[k]].parents[d.inArray(a.id,e[a.children_d[k]].parents)]=b;k=d.inArray(a.id,this._data.core.selected);-1!==k&&(this._data.core.selected[k]=b);if(k=this.get_node(a.id,!0))k.attr("id",b),this.element.attr("aria-activedescendant")===a.id&&this.element.attr("aria-activedescendant",
b);delete e[a.id];a.id=b;a.li_attr.id=b;e[b]=a;this.trigger("set_id",{node:a,"new":a.id,old:h});return!0},get_text:function(a){return(a=this.get_node(a))&&a.id!==d.jstree.root?a.text:!1},set_text:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.set_text(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;a.text=b;this.get_node(a,!0).length&&this.redraw_node(a.id);this.trigger("set_text",{obj:a,text:b});return!0},get_json:function(a,b,c){a=this.get_node(a||
d.jstree.root);if(!a)return!1;b&&b.flat&&!c&&(c=[]);var e={id:a.id,text:a.text,icon:this.get_icon(a),li_attr:d.extend(!0,{},a.li_attr),a_attr:d.extend(!0,{},a.a_attr),state:{},data:b&&b.no_data?!1:d.extend(!0,d.isArray(a.data)?[]:{},a.data)},h;b&&b.flat?e.parent=a.parent:e.children=[];if(b&&b.no_state)delete e.state;else for(k in a.state)a.state.hasOwnProperty(k)&&(e.state[k]=a.state[k]);b&&b.no_li_attr&&delete e.li_attr;b&&b.no_a_attr&&delete e.a_attr;b&&b.no_id&&(delete e.id,e.li_attr&&e.li_attr.id&&
delete e.li_attr.id,e.a_attr&&e.a_attr.id&&delete e.a_attr.id);b&&b.flat&&a.id!==d.jstree.root&&c.push(e);if(!b||!b.no_children){var k=0;for(h=a.children.length;k<h;k++)b&&b.flat?this.get_json(a.children[k],b,c):e.children.push(this.get_json(a.children[k],b))}return b&&b.flat?c:a.id===d.jstree.root?e.children:e},create_node:function(a,b,c,e,h){null===a&&(a=d.jstree.root);a=this.get_node(a);if(!a)return!1;c=c===q?"last":c;if(!c.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(a))return this.load_node(a,
function(){this.create_node(a,b,c,e,!0)});b||(b={text:this.get_string("New node")});b="string"===typeof b?{text:b}:d.extend(!0,{},b);b.text===q&&(b.text=this.get_string("New node"));var k;a.id===d.jstree.root&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":h=this.get_node(a.parent);c=d.inArray(a.id,h.children);a=h;break;case "after":h=this.get_node(a.parent);c=d.inArray(a.id,h.children)+1;a=h;break;case "inside":case "first":c=0;break;case "last":c=a.children.length;break;
default:c||(c=0)}c>a.children.length&&(c=a.children.length);b.id||(b.id=!0);if(!this.check("create_node",b,a,c))return this.settings.core.error.call(this,this._data.core.last_error),!1;!0===b.id&&delete b.id;b=this._parse_model_from_json(b,a.id,a.parents.concat());if(!b)return!1;h=this.get_node(b);var g=[];g.push(b);g=g.concat(h.children_d);this.trigger("model",{nodes:g,parent:a.id});a.children_d=a.children_d.concat(g);var m=0;for(k=a.parents.length;m<k;m++)this._model.data[a.parents[m]].children_d=
this._model.data[a.parents[m]].children_d.concat(g);b=h;h=[];m=0;for(k=a.children.length;m<k;m++)h[m>=c?m+1:m]=a.children[m];h[c]=b.id;a.children=h;this.redraw_node(a,!0);this.trigger("create_node",{node:this.get_node(b),parent:a.id,position:c});e&&e.call(this,this.get_node(b));return b.id},rename_node:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.rename_node(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;e=a.text;if(!this.check("rename_node",
a,this.get_parent(a),b))return this.settings.core.error.call(this,this._data.core.last_error),!1;this.set_text(a,b);this.trigger("rename_node",{node:a,text:b,old:e});return!0},delete_node:function(a){var b,c;if(d.isArray(a)){a=a.slice();var e=0;for(b=a.length;e<b;e++)this.delete_node(a[e]);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;e=this.get_node(a.parent);var h=d.inArray(a.id,e.children);b=!1;if(!this.check("delete_node",a,e,h))return this.settings.core.error.call(this,this._data.core.last_error),
!1;-1!==h&&(e.children=d.vakata.array_remove(e.children,h));var k=a.children_d.concat([]);k.push(a.id);h=0;for(c=a.parents.length;h<c;h++)this._model.data[a.parents[h]].children_d=d.vakata.array_filter(this._model.data[a.parents[h]].children_d,function(a){return-1===d.inArray(a,k)});h=0;for(c=k.length;h<c;h++)if(this._model.data[k[h]].state.selected){b=!0;break}b&&(this._data.core.selected=d.vakata.array_filter(this._data.core.selected,function(a){return-1===d.inArray(a,k)}));this.trigger("delete_node",
{node:a,parent:e.id});b&&this.trigger("changed",{action:"delete_node",node:a,selected:this._data.core.selected,parent:e.id});h=0;for(c=k.length;h<c;h++)delete this._model.data[k[h]];-1!==d.inArray(this._data.core.focused,k)&&(this._data.core.focused=null,a=this.element[0].scrollTop,b=this.element[0].scrollLeft,e.id===d.jstree.root?this._model.data[d.jstree.root].children[0]&&this.get_node(this._model.data[d.jstree.root].children[0],!0).children(".jstree-anchor").focus():this.get_node(e,!0).children(".jstree-anchor").focus(),
this.element[0].scrollTop=a,this.element[0].scrollLeft=b);this.redraw_node(e,!0);return!0},check:function(a,b,c,e,h){b=b&&b.id?b:this.get_node(b);c=c&&c.id?c:this.get_node(c);var k=a.match(/^move_node|copy_node|create_node$/i)?c:b,g=this.settings.core.check_callback;if("move_node"===a||"copy_node"===a){if(!(h&&h.is_multi||"move_node"!==a||d.inArray(b.id,c.children)!==e))return this._data.core.last_error={error:"check",plugin:"core",id:"core_08",reason:"Moving node to its current position",data:JSON.stringify({chk:a,
pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1;if(!(h&&h.is_multi||b.id!==c.id&&("move_node"!==a||d.inArray(b.id,c.children)!==e)&&-1===d.inArray(c.id,b.children_d)))return this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:a,pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1}k&&k.data&&(k=k.data);return k&&k.functions&&(!1===k.functions[a]||!0===k.functions[a])?(!1===k.functions[a]&&(this._data.core.last_error={error:"check",
plugin:"core",id:"core_02",reason:"Node data prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})}),k.functions[a]):!1===g||d.isFunction(g)&&!1===g.call(this,a,b,c,e,h)||g&&!1===g[a]?(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+a,data:JSON.stringify({chk:a,pos:e,obj:b&&b.id?b.id:!1,par:c&&c.id?c.id:!1})},!1):!0},last_error:function(){return this._data.core.last_error},
move_node:function(a,b,c,e,h,k,g){var m,p,v,r;b=this.get_node(b);c=c===q?0:c;if(!b)return!1;if(!c.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(b))return this.load_node(b,function(){this.move_node(a,b,c,e,!0,!1,g)});if(d.isArray(a))if(1===a.length)a=a[0];else{k=0;for(m=a.length;k<m;k++)if(p=this.move_node(a[k],b,c,e,h,!1,g))b=p,c="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||a.id===d.jstree.root)return!1;m=(a.parent||d.jstree.root).toString();var f=c.toString().match(/^(before|after)$/)&&
b.id!==d.jstree.root?this.get_node(b.parent):b;var u=g?g:this._model.data[a.id]?this:d.jstree.reference(a.id);p=!u||!u._id||this._id!==u._id;var l=u&&u._id&&m&&u._model.data[m]&&u._model.data[m].children?d.inArray(a.id,u._model.data[m].children):-1;u&&u._id&&(a=u._model.data[a.id]);if(p)return(p=this.copy_node(a,b,c,e,h,!1,g))?(u&&u.delete_node(a),p):!1;b.id===d.jstree.root&&("before"===c&&(c="first"),"after"===c&&(c="last"));switch(c){case "before":c=d.inArray(b.id,f.children);break;case "after":c=
d.inArray(b.id,f.children)+1;break;case "inside":case "first":c=0;break;case "last":c=f.children.length;break;default:c||(c=0)}c>f.children.length&&(c=f.children.length);if(!this.check("move_node",a,f,c,{core:!0,origin:g,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(a.parent===f.id){h=f.children.concat();p=d.inArray(a.id,h);-1!==p&&(h=d.vakata.array_remove(h,p),c>p&&c--);p=[];var n=0;for(v=h.length;n<v;n++)p[n>=
c?n+1:n]=h[n];p[c]=a.id;f.children=p;this._node_changed(f.id);this.redraw(f.id===d.jstree.root)}else{p=a.children_d.concat();p.push(a.id);n=0;for(v=a.parents.length;n<v;n++){h=[];var A=u._model.data[a.parents[n]].children_d;var t=0;for(r=A.length;t<r;t++)-1===d.inArray(A[t],p)&&h.push(A[t]);u._model.data[a.parents[n]].children_d=h}u._model.data[m].children=d.vakata.array_remove_item(u._model.data[m].children,a.id);n=0;for(v=f.parents.length;n<v;n++)this._model.data[f.parents[n]].children_d=this._model.data[f.parents[n]].children_d.concat(p);
h=[];n=0;for(v=f.children.length;n<v;n++)h[n>=c?n+1:n]=f.children[n];h[c]=a.id;f.children=h;f.children_d.push(a.id);f.children_d=f.children_d.concat(a.children_d);a.parent=f.id;p=f.parents.concat();p.unshift(f.id);A=a.parents.length;a.parents=p;p=p.concat();n=0;for(v=a.children_d.length;n<v;n++)this._model.data[a.children_d[n]].parents=this._model.data[a.children_d[n]].parents.slice(0,-1*A),Array.prototype.push.apply(this._model.data[a.children_d[n]].parents,p);if(m===d.jstree.root||f.id===d.jstree.root)this._model.force_full_redraw=
!0;this._model.force_full_redraw||(this._node_changed(m),this._node_changed(f.id));k||this.redraw()}e&&e.call(this,a,f,c);this.trigger("move_node",{node:a,parent:f.id,position:c,old_parent:m,old_position:l,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this});return a.id},copy_node:function(a,b,c,e,h,k,g){var m,p,v,r;b=this.get_node(b);c=c===q?0:c;if(!b)return!1;if(!c.toString().match(/^(before|after)$/)&&!h&&!this.is_loaded(b))return this.load_node(b,function(){this.copy_node(a,
b,c,e,!0,!1,g)});if(d.isArray(a))if(1===a.length)a=a[0];else{k=0;for(m=a.length;k<m;k++)if(p=this.copy_node(a[k],b,c,e,h,!0,g))b=p,c="after";this.redraw();return!0}a=a&&a.id?a:this.get_node(a);if(!a||a.id===d.jstree.root)return!1;m=(a.parent||d.jstree.root).toString();var f=c.toString().match(/^(before|after)$/)&&b.id!==d.jstree.root?this.get_node(b.parent):b;(r=g?g:this._model.data[a.id]?this:d.jstree.reference(a.id))&&r._id&&(a=r._model.data[a.id]);b.id===d.jstree.root&&("before"===c&&(c="first"),
"after"===c&&(c="last"));switch(c){case "before":c=d.inArray(b.id,f.children);break;case "after":c=d.inArray(b.id,f.children)+1;break;case "inside":case "first":c=0;break;case "last":c=f.children.length;break;default:c||(c=0)}c>f.children.length&&(c=f.children.length);if(!this.check("copy_node",a,f,c,{core:!0,origin:g,is_multi:r&&r._id&&r._id!==this._id,is_foreign:!r||!r._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;var u=r?r.get_json(a,{no_id:!0,no_data:!0,no_state:!0}):
a;if(!u)return!1;!0===u.id&&delete u.id;u=this._parse_model_from_json(u,f.id,f.parents.concat());if(!u)return!1;p=this.get_node(u);a&&a.state&&!1===a.state.loaded&&(p.state.loaded=!1);h=[];h.push(u);h=h.concat(p.children_d);this.trigger("model",{nodes:h,parent:f.id});u=0;for(v=f.parents.length;u<v;u++)this._model.data[f.parents[u]].children_d=this._model.data[f.parents[u]].children_d.concat(h);h=[];u=0;for(v=f.children.length;u<v;u++)h[u>=c?u+1:u]=f.children[u];h[c]=p.id;f.children=h;f.children_d.push(p.id);
f.children_d=f.children_d.concat(p.children_d);f.id===d.jstree.root&&(this._model.force_full_redraw=!0);this._model.force_full_redraw||this._node_changed(f.id);k||this.redraw(f.id===d.jstree.root);e&&e.call(this,p,f,c);this.trigger("copy_node",{node:p,original:a,parent:f.id,position:c,old_parent:m,old_position:r&&r._id&&m&&r._model.data[m]&&r._model.data[m].children?d.inArray(a.id,r._model.data[m].children):-1,is_multi:r&&r._id&&r._id!==this._id,is_foreign:!r||!r._id,old_instance:r,new_instance:this});
return p.id},cut:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,e;var h=0;for(e=a.length;h<e;h++)(c=this.get_node(a[h]))&&c.id&&c.id!==d.jstree.root&&b.push(c);if(!b.length)return!1;f=b;n=this;l="move_node";this.trigger("cut",{node:a})},copy:function(a){a||(a=this._data.core.selected.concat());d.isArray(a)||(a=[a]);if(!a.length)return!1;var b=[],c,e;var h=0;for(e=a.length;h<e;h++)(c=this.get_node(a[h]))&&c.id&&c.id!==d.jstree.root&&b.push(c);
if(!b.length)return!1;f=b;n=this;l="copy_node";this.trigger("copy",{node:a})},get_buffer:function(){return{mode:l,node:f,inst:n}},can_paste:function(){return!1!==l&&!1!==f},paste:function(a,b){a=this.get_node(a);if(!(a&&l&&l.match(/^(copy_node|move_node)$/)&&f))return!1;this[l](f,a,b,!1,!1,!1,n)&&this.trigger("paste",{parent:a.id,node:f,mode:l});n=l=f=!1},clear_buffer:function(){n=l=f=!1;this.trigger("clear_buffer")},edit:function(a,b,c){var e=!1;a=this.get_node(a);if(!a)return!1;if(!this.check("edit",
a,this.get_parent(a)))return this.settings.core.error.call(this,this._data.core.last_error),!1;var h=a;b="string"===typeof b?b:a.text;this.set_text(a,"");a=this._open_to(a);h.text=b;var k=this._data.core.rtl;var g=this.element.width();this._data.core.focused=h.id;var m=a.children(".jstree-anchor").focus();var p=d("<span>");var f=b;var r=d("<div />",{css:{position:"absolute",top:"-200px",left:k?"0px":"-1000px",visibility:"hidden"}}).appendTo(t.body);var l=d("<input />",{value:f,"class":"jstree-rename-input",
css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:d.proxy(function(b){b.stopImmediatePropagation();b.preventDefault();b=p.children(".jstree-rename-input").val();var g=this.settings.core.force_text;""===b&&(b=f);r.remove();p.replaceWith(m);p.remove();f=g?f:d("<div></div>").append(d.parseHTML(f)).html();a=this.get_node(a);this.set_text(a,f);(b=!!this.rename_node(a,
g?d("<div></div>").text(b).text():d("<div></div>").append(d.parseHTML(b)).html()))||this.set_text(a,f);this._data.core.focused=h.id;setTimeout(d.proxy(function(){var a=this.get_node(h.id,!0);a.length&&(this._data.core.focused=h.id,a.children(".jstree-anchor").focus())},this),0);c&&c.call(this,h,b,e);l=null},this),keydown:function(a){var c=a.which;27===c&&(e=!0,this.value=f);27!==c&&13!==c&&37!==c&&38!==c&&39!==c&&40!==c&&32!==c||a.stopImmediatePropagation();if(27===c||13===c)a.preventDefault(),this.blur()},
click:function(a){a.stopImmediatePropagation()},mousedown:function(a){a.stopImmediatePropagation()},keyup:function(a){l.width(Math.min(r.text("pW"+this.value).width(),g))},keypress:function(a){if(13===a.which)return!1}});b={fontFamily:m.css("fontFamily")||"",fontSize:m.css("fontSize")||"",fontWeight:m.css("fontWeight")||"",fontStyle:m.css("fontStyle")||"",fontStretch:m.css("fontStretch")||"",fontVariant:m.css("fontVariant")||"",letterSpacing:m.css("letterSpacing")||"",wordSpacing:m.css("wordSpacing")||
""};p.attr("class",m.attr("class")).append(m.contents().clone()).append(l);m.replaceWith(p);r.css(b);l.css(b).width(Math.min(r.text("pW"+l[0].value).width(),g))[0].select();d(t).one("mousedown.jstree touchstart.jstree dnd_start.vakata",function(a){l&&a.target!==l&&d(l).blur()})},set_theme:function(a,b){if(!a)return!1;!0===b&&((b=this.settings.core.themes.dir)||(b=d.jstree.path+"/themes"),b=b+"/"+a+"/style.css");b&&-1===d.inArray(b,w)&&(d("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />'),
w.push(b));this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name);this._data.core.themes.name=a;this.element.addClass("jstree-"+a);this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+a+"-responsive");this.trigger("set_theme",{theme:a})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(a){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant);
(this._data.core.themes.variant=a)&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0;this.get_container_ul().addClass("jstree-striped");this.trigger("show_stripes")},hide_stripes:function(){this._data.core.themes.stripes=!1;this.get_container_ul().removeClass("jstree-striped");this.trigger("hide_stripes")},toggle_stripes:function(){this._data.core.themes.stripes?
this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0;this.get_container_ul().removeClass("jstree-no-dots");this.trigger("show_dots")},hide_dots:function(){this._data.core.themes.dots=!1;this.get_container_ul().addClass("jstree-no-dots");this.trigger("hide_dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0;this.get_container_ul().removeClass("jstree-no-icons");this.trigger("show_icons")},
hide_icons:function(){this._data.core.themes.icons=!1;this.get_container_ul().addClass("jstree-no-icons");this.trigger("hide_icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},show_ellipsis:function(){this._data.core.themes.ellipsis=!0;this.get_container_ul().addClass("jstree-ellipsis");this.trigger("show_ellipsis")},hide_ellipsis:function(){this._data.core.themes.ellipsis=!1;this.get_container_ul().removeClass("jstree-ellipsis");this.trigger("hide_ellipsis")},
toggle_ellipsis:function(){this._data.core.themes.ellipsis?this.hide_ellipsis():this.show_ellipsis()},set_icon:function(a,b){var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.set_icon(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;c=a.icon;a.icon=!0===b||null===b||b===q||""===b?!0:b;e=this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon");!1===b?(e.removeClass("jstree-themeicon-custom "+c).css("background","").removeAttr("rel"),
this.hide_icon(a)):(!0===b||null===b||b===q||""===b?e.removeClass("jstree-themeicon-custom "+c).css("background","").removeAttr("rel"):-1===b.indexOf("/")&&-1===b.indexOf(".")?(e.removeClass(c).css("background",""),e.addClass(b+" jstree-themeicon-custom").attr("rel",b)):(e.removeClass(c).css("background",""),e.addClass("jstree-themeicon-custom").css("background","url('"+b+"') center center no-repeat").attr("rel",b)),!1===c&&this.show_icon(a));return!0},get_icon:function(a){return(a=this.get_node(a))&&
a.id!==d.jstree.root?a.icon:!1},hide_icon:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.hide_icon(a[c]);return!0}a=this.get_node(a);if(!a||a===d.jstree.root)return!1;a.icon=!1;this.get_node(a,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden");return!0},show_icon:function(a){var b;if(d.isArray(a)){a=a.slice();var c=0;for(b=a.length;c<b;c++)this.show_icon(a[c]);return!0}a=this.get_node(a);if(!a||a===d.jstree.root)return!1;
c=this.get_node(a,!0);a.icon=c.length?c.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"):!0;a.icon||(a.icon=!0);c.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden");return!0}};d.vakata={};d.vakata.attributes=function(a,b){a=d(a)[0];var c=b?{}:[];a&&a.attributes&&d.each(a.attributes,function(a,h){-1===d.inArray(h.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==h.value&&""!==d.trim(h.value)&&(b?c[h.name]=
h.value:c.push(h.name))});return c};d.vakata.array_unique=function(a){var b=[],c,e={};var d=0;for(c=a.length;d<c;d++)e[a[d]]===q&&(b.push(a[d]),e[a[d]]=!0);return b};d.vakata.array_remove=function(a,b){a.splice(b,1);return a};d.vakata.array_remove_item=function(a,b){b=d.inArray(b,a);return-1!==b?d.vakata.array_remove(a,b):a};d.vakata.array_filter=function(a,b,c,e,d){if(a.filter)return a.filter(b,c);e=[];for(d in a)~~d+""===d+""&&0<=d&&b.call(c,a[d],+d,a)&&e.push(a[d]);return e};d.jstree.plugins.changed=
function(a,b){var c=[];this.trigger=function(a,d){var e;d||(d={});if("changed"===a.replace(".jstree","")){d.changed={selected:[],deselected:[]};var h={};var m=0;for(e=c.length;m<e;m++)h[c[m]]=1;m=0;for(e=d.selected.length;m<e;m++)h[d.selected[m]]?h[d.selected[m]]=2:d.changed.selected.push(d.selected[m]);m=0;for(e=c.length;m<e;m++)1===h[c[m]]&&d.changed.deselected.push(c[m]);c=d.selected.slice()}b.trigger.call(this,a,d)};this.refresh=function(a,d){c=[];return b.refresh.apply(this,arguments)}};var H=
t.createElement("I");H.className="jstree-icon jstree-checkbox";H.setAttribute("role","presentation");d.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0,cascade_to_disabled:!0,cascade_to_hidden:!0};d.jstree.plugins.checkbox=function(a,b){this.bind=function(){b.bind.call(this);this._data.checkbox.uto=!1;this._data.checkbox.selected=[];this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined");this.element.on("init.jstree",
d.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible;this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked");this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",d.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this));if(-1!==this.settings.checkbox.cascade.indexOf("undetermined"))this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",
d.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto);this._data.checkbox.uto=setTimeout(d.proxy(this._undetermined,this),50)},this));if(!this.settings.checkbox.tie_selection)this.element.on("model.jstree",d.proxy(function(a,b){a=this._model.data;b=b.nodes;var c;var d=0;for(c=b.length;d<c;d++)a[b[d]].state.checked=a[b[d]].state.checked||a[b[d]].original&&a[b[d]].original.state&&a[b[d]].original.state.checked,a[b[d]].state.checked&&this._data.checkbox.selected.push(b[d])},
this));if(-1!==this.settings.checkbox.cascade.indexOf("up")||-1!==this.settings.checkbox.cascade.indexOf("down"))this.element.on("model.jstree",d.proxy(function(a,b){a=this._model.data;var c=a[b.parent],e=b.nodes;b=[];var g,m,p=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection;if(-1!==p.indexOf("down"))if(c.state[f?"selected":"checked"]){var r=0;for(g=e.length;r<g;r++)a[e[r]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(e)}else for(r=
0,g=e.length;r<g;r++)if(a[e[r]].state[f?"selected":"checked"]){var l=0;for(m=a[e[r]].children_d.length;l<m;l++)a[a[e[r]].children_d[l]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(a[e[r]].children_d)}if(-1!==p.indexOf("up")){r=0;for(g=c.children_d.length;r<g;r++)a[c.children_d[r]].children.length||b.push(a[c.children_d[r]].parent);b=d.vakata.array_unique(b);l=0;for(m=b.length;l<m;l++)for(c=a[b[l]];c&&c.id!==d.jstree.root;){r=
e=0;for(g=c.children.length;r<g;r++)e+=a[c.children[r]].state[f?"selected":"checked"];if(e===g)c.state[f?"selected":"checked"]=!0,this._data[f?"core":"checkbox"].selected.push(c.id),(r=this.get_node(c,!0))&&r.length&&r.attr("aria-selected",!0).children(".jstree-anchor").addClass(f?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}}this._data[f?"core":"checkbox"].selected=d.vakata.array_unique(this._data[f?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?
"select_node.jstree":"check_node.jstree",d.proxy(function(a,b){var c=b.node;a=this._model.data;b=this.get_node(c.parent);var e;var g=this.settings.checkbox.cascade;var m=this.settings.checkbox.tie_selection,p={},f=this._data[m?"core":"checkbox"].selected;var r=0;for(e=f.length;r<e;r++)p[f[r]]=!0;if(-1!==g.indexOf("down"))for(f=this._cascade_new_checked_state(c.id,!0),c=c.children_d.concat(c.id),r=0,e=c.length;r<e;r++)-1<f.indexOf(c[r])?p[c[r]]=!0:delete p[c[r]];if(-1!==g.indexOf("up"))for(;b&&b.id!==
d.jstree.root;){r=g=0;for(e=b.children.length;r<e;r++)g+=a[b.children[r]].state[m?"selected":"checked"];if(g===e)b.state[m?"selected":"checked"]=!0,p[b.id]=!0,(e=this.get_node(b,!0))&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked");else break;b=this.get_node(b.parent)}f=[];for(r in p)p.hasOwnProperty(r)&&f.push(r);this._data[m?"core":"checkbox"].selected=f},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",
d.proxy(function(a,b){a=this.get_node(d.jstree.root);b=this._model.data;var c,e;var g=0;for(c=a.children_d.length;g<c;g++)(e=b[a.children_d[g]])&&e.original&&e.original.state&&e.original.state.undetermined&&(e.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",d.proxy(function(a,b){var c=b.node;this.get_node(c,!0);var e;var g=this.settings.checkbox.cascade;a=this.settings.checkbox.tie_selection;b=this._data[a?"core":"checkbox"].selected;
var m=c.children_d.concat(c.id);if(-1!==g.indexOf("down")){var p=this._cascade_new_checked_state(c.id,!1);b=d.vakata.array_filter(b,function(a){return-1===m.indexOf(a)||-1<p.indexOf(a)})}if(-1!==g.indexOf("up")&&-1===b.indexOf(c.id)){g=0;for(e=c.parents.length;g<e;g++){var f=this._model.data[c.parents[g]];f.state[a?"selected":"checked"]=!1;f&&f.original&&f.original.state&&f.original.state.undetermined&&(f.original.state.undetermined=!1);(f=this.get_node(c.parents[g],!0))&&f.length&&f.attr("aria-selected",
!1).children(".jstree-anchor").removeClass(a?"jstree-clicked":"jstree-checked")}b=d.vakata.array_filter(b,function(a){return-1===c.parents.indexOf(a)})}this._data[a?"core":"checkbox"].selected=b},this));if(-1!==this.settings.checkbox.cascade.indexOf("up"))this.element.on("delete_node.jstree",d.proxy(function(a,b){a=this.get_node(b.parent);b=this._model.data;for(var c,e,g,m=this.settings.checkbox.tie_selection;a&&a.id!==d.jstree.root&&!a.state[m?"selected":"checked"];){c=g=0;for(e=a.children.length;c<
e;c++)g+=b[a.children[c]].state[m?"selected":"checked"];if(0<e&&g===e)a.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(a.id),(c=this.get_node(a,!0))&&c.length&&c.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked");else break;a=this.get_node(a.parent)}},this)).on("move_node.jstree",d.proxy(function(a,b){var c=b.is_multi,e=b.old_parent;b=this.get_node(b.parent);a=this._model.data;var g,m=this.settings.checkbox.tie_selection;
if(!c)for(c=this.get_node(e);c&&c.id!==d.jstree.root&&!c.state[m?"selected":"checked"];){var f=e=0;for(g=c.children.length;f<g;f++)e+=a[c.children[f]].state[m?"selected":"checked"];if(0<g&&e===g)c.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(c.id),(e=this.get_node(c,!0))&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}for(c=b;c&&c.id!==d.jstree.root;){f=e=0;for(g=c.children.length;f<
g;f++)e+=a[c.children[f]].state[m?"selected":"checked"];if(e===g)c.state[m?"selected":"checked"]||(c.state[m?"selected":"checked"]=!0,this._data[m?"core":"checkbox"].selected.push(c.id),(e=this.get_node(c,!0))&&e.length&&e.attr("aria-selected",!0).children(".jstree-anchor").addClass(m?"jstree-clicked":"jstree-checked"));else if(c.state[m?"selected":"checked"])c.state[m?"selected":"checked"]=!1,this._data[m?"core":"checkbox"].selected=d.vakata.array_remove_item(this._data[m?"core":"checkbox"].selected,
c.id),(e=this.get_node(c,!0))&&e.length&&e.attr("aria-selected",!1).children(".jstree-anchor").removeClass(m?"jstree-clicked":"jstree-checked");else break;c=this.get_node(c.parent)}},this))};this.get_undetermined=function(a){if(-1===this.settings.checkbox.cascade.indexOf("undetermined"))return[];var c,b,k={},g=this._model.data,m=this.settings.checkbox.tie_selection,f=this._data[m?"core":"checkbox"].selected,v=[],r=this,l=[];var u=0;for(c=f.length;u<c;u++)if(g[f[u]]&&g[f[u]].parents){var n=0;for(b=
g[f[u]].parents.length;n<b&&k[g[f[u]].parents[n]]===q;n++)g[f[u]].parents[n]!==d.jstree.root&&(k[g[f[u]].parents[n]]=!0,v.push(g[f[u]].parents[n]))}this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var a=r.get_node(this);if(a)if(a.state.loaded)for(u=0,c=a.children_d.length;u<c;u++){var e=g[a.children_d[u]];if(!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined)for(k[e.id]===q&&e.id!==d.jstree.root&&(k[e.id]=
!0,v.push(e.id)),n=0,b=e.parents.length;n<b;n++)k[e.parents[n]]===q&&e.parents[n]!==d.jstree.root&&(k[e.parents[n]]=!0,v.push(e.parents[n]))}else if(a.original&&a.original.state&&a.original.state.undetermined&&!0===a.original.state.undetermined)for(k[a.id]===q&&a.id!==d.jstree.root&&(k[a.id]=!0,v.push(a.id)),n=0,b=a.parents.length;n<b;n++)k[a.parents[n]]===q&&a.parents[n]!==d.jstree.root&&(k[a.parents[n]]=!0,v.push(a.parents[n]))});u=0;for(c=v.length;u<c;u++)g[v[u]].state[m?"selected":"checked"]||
l.push(a?g[v[u]]:v[u]);return l};this._undetermined=function(){if(null!==this.element){var a=this.get_undetermined(!1),b,d;this.element.find(".jstree-undetermined").removeClass("jstree-undetermined");var k=0;for(b=a.length;k<b;k++)(d=this.get_node(a[k],!0))&&d.length&&d.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}};this.redraw_node=function(a,e,h,k){if(a=b.redraw_node.apply(this,arguments)){var c,m=null;var f=0;for(c=a.childNodes.length;f<c;f++)if(a.childNodes[f]&&
a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){m=a.childNodes[f];break}m&&(!this.settings.checkbox.tie_selection&&this._model.data[a.id].state.checked&&(m.className+=" jstree-checked"),f=H.cloneNode(!1),this._model.data[a.id].state.checkbox_disabled&&(f.className+=" jstree-checkbox-disabled"),m.insertBefore(f,m.childNodes[0]))}h||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=
setTimeout(d.proxy(this._undetermined,this),50));return a};this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0;this.get_container_ul().removeClass("jstree-no-checkboxes")};this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1;this.get_container_ul().addClass("jstree-no-checkboxes")};this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()};this.is_undetermined=function(a){a=this.get_node(a);var c=this.settings.checkbox.cascade;
var b=this.settings.checkbox.tie_selection;var k=this._data[b?"core":"checkbox"].selected,g=this._model.data;if(!a||!0===a.state[b?"selected":"checked"]||-1===c.indexOf("undetermined")||-1===c.indexOf("down")&&-1===c.indexOf("up"))return!1;if(!a.state.loaded&&!0===a.original.state.undetermined)return!0;c=0;for(b=a.children_d.length;c<b;c++)if(-1!==d.inArray(a.children_d[c],k)||!g[a.children_d[c]].state.loaded&&g[a.children_d[c]].original.state.undetermined)return!0;return!1};this.disable_checkbox=
function(a){var c;if(d.isArray(a)){a=a.slice();var b=0;for(c=a.length;b<c;b++)this.disable_checkbox(a[b]);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;b=this.get_node(a,!0);a.state.checkbox_disabled||(a.state.checkbox_disabled=!0,b&&b.length&&b.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-checkbox-disabled"),this.trigger("disable_checkbox",{node:a}))};this.enable_checkbox=function(a){var c;if(d.isArray(a)){a=a.slice();var b=0;for(c=a.length;b<c;b++)this.enable_checkbox(a[b]);
return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;b=this.get_node(a,!0);a.state.checkbox_disabled&&(a.state.checkbox_disabled=!1,b&&b.length&&b.children(".jstree-anchor").children(".jstree-checkbox").removeClass("jstree-checkbox-disabled"),this.trigger("enable_checkbox",{node:a}))};this.activate_node=function(a,e){if(d(e.target).hasClass("jstree-checkbox-disabled"))return!1;this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||d(e.target).hasClass("jstree-checkbox"))&&
(e.ctrlKey=!0);if(this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!d(e.target).hasClass("jstree-checkbox"))return b.activate_node.call(this,a,e);if(this.is_disabled(a))return!1;this.is_checked(a)?this.uncheck_node(a,e):this.check_node(a,e);this.trigger("activate_node",{node:this.get_node(a)})};this._cascade_new_checked_state=function(a,b){var c=this.settings.checkbox.tie_selection,d=this._model.data[a],e=[],m=[],f;if(!this.settings.checkbox.cascade_to_disabled&&d.state.disabled||
!this.settings.checkbox.cascade_to_hidden&&d.state.hidden){var v=this.get_checked_descendants(a);d.state[c?"selected":"checked"]&&v.push(d.id);e=e.concat(v)}else{if(d.children)for(a=0,f=d.children.length;a<f;a++){var r=d.children[a];v=this._cascade_new_checked_state(r,b);e=e.concat(v);-1<v.indexOf(r)&&m.push(r)}a=this.get_node(d,!0);f=0<m.length&&m.length<d.children.length;d.original&&d.original.state&&d.original.state.undetermined&&(d.original.state.undetermined=f);f?(d.state[c?"selected":"checked"]=
!1,a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked")):b&&m.length===d.children.length?(d.state[c?"selected":"checked"]=b,e.push(d.id),a.attr("aria-selected",!0).children(".jstree-anchor").addClass(c?"jstree-clicked":"jstree-checked")):(d.state[c?"selected":"checked"]=!1,a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(c?"jstree-clicked":"jstree-checked"))}return e};this.get_checked_descendants=function(a){var c=this,b=c.settings.checkbox.tie_selection;
return d.vakata.array_filter(c._model.data[a].children_d,function(a){return c._model.data[a].state[b?"selected":"checked"]})};this.check_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.select_node(a,!1,!0,b);var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.check_node(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;e=this.get_node(a,!0);a.state.checked||(a.state.checked=!0,this._data.checkbox.selected.push(a.id),e&&e.length&&e.children(".jstree-anchor").addClass("jstree-checked"),
this.trigger("check_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.uncheck_node=function(a,b){if(this.settings.checkbox.tie_selection)return this.deselect_node(a,!1,b);var c;if(d.isArray(a)){a=a.slice();var e=0;for(c=a.length;e<c;e++)this.uncheck_node(a[e],b);return!0}a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;e=this.get_node(a,!0);a.state.checked&&(a.state.checked=!1,this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,a.id),e.length&&
e.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:a,selected:this._data.checkbox.selected,event:b}))};this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();this._data.checkbox.selected.concat([]);var a;this._data.checkbox.selected=this._model.data[d.jstree.root].children_d.concat();var b=0;for(a=this._data.checkbox.selected.length;b<a;b++)this._model.data[this._data.checkbox.selected[b]]&&(this._model.data[this._data.checkbox.selected[b]].state.checked=
!0);this.redraw(!0);this.trigger("check_all",{selected:this._data.checkbox.selected})};this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var a=this._data.checkbox.selected.concat([]),b;var d=0;for(b=this._data.checkbox.selected.length;d<b;d++)this._model.data[this._data.checkbox.selected[d]]&&(this._model.data[this._data.checkbox.selected[d]].state.checked=!1);this._data.checkbox.selected=[];this.element.find(".jstree-checked").removeClass("jstree-checked");
this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:a})};this.is_checked=function(a){return this.settings.checkbox.tie_selection?this.is_selected(a):(a=this.get_node(a))&&a.id!==d.jstree.root?a.state.checked:!1};this.get_checked=function(a){return this.settings.checkbox.tie_selection?this.get_selected(a):a?d.map(this._data.checkbox.selected,d.proxy(function(a){return this.get_node(a)},this)):this._data.checkbox.selected.slice()};this.get_top_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_top_selected(a);
var c=this.get_checked(!0),b={},k,g;var m=0;for(k=c.length;m<k;m++)b[c[m].id]=c[m];m=0;for(k=c.length;m<k;m++){var f=0;for(g=c[m].children_d.length;f<g;f++)b[c[m].children_d[f]]&&delete b[c[m].children_d[f]]}c=[];for(m in b)b.hasOwnProperty(m)&&c.push(m);return a?d.map(c,d.proxy(function(a){return this.get_node(a)},this)):c};this.get_bottom_checked=function(a){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(a);var c=this.get_checked(!0),b=[],k;var g=0;for(k=c.length;g<k;g++)c[g].children.length||
b.push(c[g].id);return a?d.map(b,d.proxy(function(a){return this.get_node(a)},this)):b};this.load_node=function(a,e){var c,k;if(!d.isArray(a)&&!this.settings.checkbox.tie_selection&&(k=this.get_node(a))&&k.state.loaded){var g=0;for(c=k.children_d.length;g<c;g++)this._model.data[k.children_d[g]].state.checked&&(this._data.checkbox.selected=d.vakata.array_remove_item(this._data.checkbox.selected,k.children_d[g]))}return b.load_node.apply(this,arguments)};this.get_state=function(){var a=b.get_state.apply(this,
arguments);if(this.settings.checkbox.tie_selection)return a;a.checkbox=this._data.checkbox.selected.slice();return a};this.set_state=function(a,e){var c=b.set_state.apply(this,arguments);if(c&&a.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var k=this;d.each(a.checkbox,function(a,c){k.check_node(c)})}delete a.checkbox;this.set_state(a,e);return!1}return c};this.refresh=function(a,d){this.settings.checkbox.tie_selection&&(this._data.checkbox.selected=[]);return b.refresh.apply(this,
arguments)}};d.jstree.defaults.conditionalselect=function(){return!0};d.jstree.plugins.conditionalselect=function(a,b){this.activate_node=function(a,d){if(this.settings.conditionalselect.call(this,this.get_node(a),d))return b.activate_node.call(this,a,d)}};d.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(a,b){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);
c.create_node(a,{},"last",function(a){try{c.edit(a)}catch(k){setTimeout(function(){c.edit(a)},0)}})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.edit(a)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.delete_node(c.get_selected()):c.delete_node(a)}},
ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.cut(c.get_top_selected()):c.cut(a)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.is_selected(a)?c.copy(c.get_top_selected()):c.copy(a)}},paste:{separator_before:!1,
icon:!1,_disabled:function(a){return!d.jstree.reference(a.reference).can_paste()},separator_after:!1,label:"Paste",action:function(a){var c=d.jstree.reference(a.reference);a=c.get_node(a.reference);c.paste(a)}}}}}}};d.jstree.plugins.contextmenu=function(a,b){this.bind=function(){b.bind.call(this);var a=0,e=null,h,k;this.element.on("init.jstree loading.jstree ready.jstree",d.proxy(function(){this.get_container_ul().addClass("jstree-contextmenu")},this)).on("contextmenu.jstree",".jstree-anchor",d.proxy(function(c,
b){if("input"!==c.target.tagName.toLowerCase()){c.preventDefault();a=c.ctrlKey?+new Date:0;if(b||e)a=+new Date+1E4;e&&clearTimeout(e);this.is_loading(c.currentTarget)||this.show_contextmenu(c.currentTarget,c.pageX,c.pageY,c)}},this)).on("click.jstree",".jstree-anchor",d.proxy(function(c){this._data.contextmenu.visible&&(!a||250<+new Date-a)&&d.vakata.context.hide();a=0},this)).on("touchstart.jstree",".jstree-anchor",function(a){a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&
(h=a.originalEvent.changedTouches[0].clientX,k=a.originalEvent.changedTouches[0].clientY,e=setTimeout(function(){d(a.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(a){e&&a.originalEvent&&a.originalEvent.changedTouches&&a.originalEvent.changedTouches[0]&&(10<Math.abs(h-a.originalEvent.changedTouches[0].clientX)||10<Math.abs(k-a.originalEvent.changedTouches[0].clientY))&&(clearTimeout(e),d.vakata.context.hide())}).on("touchend.vakata.jstree",function(a){e&&clearTimeout(e)});
d(t).on("context_hide.vakata.jstree",d.proxy(function(a,c){this._data.contextmenu.visible=!1;d(c.reference).removeClass("jstree-context")},this))};this.teardown=function(){this._data.contextmenu.visible&&d.vakata.context.hide();b.teardown.call(this)};this.show_contextmenu=function(a,b,h,k){a=this.get_node(a);if(!a||a.id===d.jstree.root)return!1;var c=this.settings.contextmenu,e=this.get_node(a,!0).children(".jstree-anchor"),f=!1;f=!1;if(c.show_at_node||b===q||h===q)f=e.offset(),b=f.left,h=f.top+this._data.core.li_height;
this.settings.contextmenu.select_node&&!this.is_selected(a)&&this.activate_node(a,k);f=c.items;d.isFunction(f)&&(f=f.call(this,a,d.proxy(function(c){this._show_contextmenu(a,b,h,c)},this)));d.isPlainObject(f)&&this._show_contextmenu(a,b,h,f)};this._show_contextmenu=function(a,b,h,k){var c=this.get_node(a,!0).children(".jstree-anchor");d(t).one("context_show.vakata.jstree",d.proxy(function(a,b){a="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";d(b.element).addClass(a);c.addClass("jstree-context")},
this));this._data.contextmenu.visible=!0;d.vakata.context.show(c,{x:b,y:h},k);this.trigger("show_contextmenu",{node:a,x:b,y:h})}};(function(a){var b=!1,c=!1,d=!1,h=0,k=0,g=[],f="",p=!1;a.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(b){a(t).triggerHandler("context_"+b+".vakata",{reference:d,element:c,position:{x:h,y:k}})},_execute:function(b){return(b=g[b])&&(!b._disabled||a.isFunction(b._disabled)&&!b._disabled({item:b,reference:d,element:c}))&&b.action?b.action.call(null,
{item:b,reference:d,element:c,position:{x:h,y:k}}):!1},_parse:function(b,e){if(!b)return!1;e||(f="",g=[]);var h="",k=!1,m;e&&(h+="<ul>");a.each(b,function(b,e){if(!e)return!0;g.push(e);!k&&e.separator_before&&(h+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>");k=!1;h+="<li class='"+(e._class||"")+(!0===e._disabled||a.isFunction(e._disabled)&&e._disabled({item:e,reference:d,element:c})?" vakata-contextmenu-disabled ":
"")+"' "+(e.shortcut?" data-shortcut='"+e.shortcut+"' ":"")+">";h+="<a href='#' rel='"+(g.length-1)+"' "+(e.title?"title='"+e.title+"'":"")+">";a.vakata.context.settings.icons&&(h+="<i ",e.icon&&(h=-1!==e.icon.indexOf("/")||-1!==e.icon.indexOf(".")?h+(" style='background:url(\""+e.icon+"\") center center no-repeat' "):h+(" class='"+e.icon+"' ")),h+="></i><span class='vakata-contextmenu-sep'>&#160;</span>");h+=(a.isFunction(e.label)?e.label({item:b,reference:d,element:c}):e.label)+(e.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+
e.shortcut+'">'+(e.shortcut_label||"")+"</span>":"")+"</a>";e.submenu&&(m=a.vakata.context._parse(e.submenu,!0))&&(h+=m);h+="</li>";e.separator_after&&(h+="<li class='vakata-context-separator'><a href='#' "+(a.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",k=!0)});h=h.replace(/<li class='vakata-context-separator'><\/li>$/,"");e&&(h+="</ul>");e||(f=h,a.vakata.context._trigger("parse"));return 10<h.length?h:!1},_show_submenu:function(c){c=a(c);if(c.length&&c.children("ul").length){var d=
c.children("ul"),e=c.offset().left,h=e+c.outerWidth(),g=c.offset().top,k=d.width(),f=d.height(),m=a(window).width()+a(window).scrollLeft(),p=a(window).height()+a(window).scrollTop();if(b)c[0>h-(k+10+c.outerWidth())?"addClass":"removeClass"]("vakata-context-left");else c[h+k>m&&e>m-h?"addClass":"removeClass"]("vakata-context-right");g+f+10>p&&d.css("bottom","-1px");c.hasClass("vakata-context-right")?e<k&&d.css("margin-right",e-k):m-h<k&&d.css("margin-left",m-h-k);d.show()}},show:function(e,m,l){c&&
c.length&&c.width("");switch(!0){case !m&&!e:return!1;case !!m&&!!e:d=e;h=m.x;k=m.y;break;case !m&&!!e:d=e;m=e.offset();h=m.left+e.outerHeight();k=m.top;break;case !!m&&!e:h=m.x,k=m.y}e&&!l&&a(e).data("vakata_contextmenu")&&(l=a(e).data("vakata_contextmenu"));a.vakata.context._parse(l)&&c.html(f);if(g.length){c.appendTo(t.body);l=c;m=h;var r=k;var n=l.width();var v=l.height();var A=a(window).width()+a(window).scrollLeft();var q=a(window).height()+a(window).scrollTop();b&&(m-=l.outerWidth()-a(e).outerWidth(),
m<a(window).scrollLeft()+20&&(m=a(window).scrollLeft()+20));m+n+20>A&&(m=A-(n+20));r+v+20>q&&(r=q-(v+20));c.css({left:m,top:r}).show().find("a").first().focus().parent().addClass("vakata-context-hover");p=!0;a.vakata.context._trigger("show")}},hide:function(){p&&(c.hide().find("ul").hide().end().find(":focus").blur().end().detach(),p=!1,a.vakata.context._trigger("hide"))}};a(function(){b="rtl"===a(t.body).css("direction");var d=!1;c=a("<ul class='vakata-context'></ul>");c.on("mouseenter","li",function(b){b.stopImmediatePropagation();
a.contains(this,b.relatedTarget)||(d&&clearTimeout(d),c.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),a(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),a.vakata.context._show_submenu(this))}).on("mouseleave","li",function(c){a.contains(this,c.relatedTarget)||a(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(c){a(this).find(".vakata-context-hover").removeClass("vakata-context-hover");
a.vakata.context.settings.hide_onmouseleave&&(d=setTimeout(function(c){return function(){a.vakata.context.hide()}}(this),a.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(c){c.preventDefault();a(this).blur().parent().hasClass("vakata-context-disabled")||!1===a.vakata.context._execute(a(this).attr("rel"))||a.vakata.context.hide()}).on("keydown","a",function(b){switch(b.which){case 13:case 32:b.type="click";b.preventDefault();a(b.currentTarget).trigger(b);break;case 37:p&&(c.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),
b.stopImmediatePropagation(),b.preventDefault());break;case 38:if(p){var d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first();d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last());d.addClass("vakata-context-hover").children("a").focus();b.stopImmediatePropagation();b.preventDefault()}break;case 39:p&&(c.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),
b.stopImmediatePropagation(),b.preventDefault());break;case 40:p&&(d=c.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),d.length||(d=c.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),d.addClass("vakata-context-hover").children("a").focus(),b.stopImmediatePropagation(),b.preventDefault());break;case 27:a.vakata.context.hide(),b.preventDefault()}}).on("keydown",
function(a){a.preventDefault();a=c.find(".vakata-contextmenu-shortcut-"+a.which).parent();a.parent().not(".vakata-context-disabled")&&a.click()});a(t).on("mousedown.vakata.jstree",function(b){p&&c[0]!==b.target&&!a.contains(c[0],b.target)&&a.vakata.context.hide()}).on("context_show.vakata.jstree",function(a,d){c.find("li:has(ul)").children("a").addClass("vakata-context-parent");b&&c.addClass("vakata-context-rtl").css("direction","rtl");c.find("ul").hide().end()})})})(d);d.jstree.defaults.dnd={copy:!0,
open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1,use_html5:!1};var z,B;d.jstree.plugins.dnd=function(a,b){this.init=function(a,d){b.init.call(this,a,d);this.settings.dnd.use_html5=this.settings.dnd.use_html5&&"draggable"in t.createElement("span")};this.bind=function(){b.bind.call(this);this.element.on(this.settings.dnd.use_html5?"dragstart.jstree":"mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?
".jstree-node":".jstree-anchor",d.proxy(function(a){if(this.settings.dnd.large_drag_target&&d(a.target).closest(".jstree-node")[0]!==a.currentTarget||"touchstart"===a.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var c=this.get_node(a.target),b=this.is_selected(c)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,k=1<b?b+" "+this.get_string("nodes"):
this.get_text(a.currentTarget);this.settings.core.force_text&&(k=d.vakata.html.escape(k));if(c&&c.id&&c.id!==d.jstree.root&&(1===a.which||"touchstart"===a.type||"dragstart"===a.type)&&(!0===this.settings.dnd.is_draggable||d.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,1<b?this.get_top_selected(!0):[c],a)))if(z={jstree:!0,origin:this,obj:this.get_node(c,!0),nodes:1<b?this.get_top_selected():[c.id]},B=a.currentTarget,this.settings.dnd.use_html5)d.vakata.dnd._trigger("start",
a,{helper:d(),element:B,data:z});else return this.element.trigger("mousedown.jstree"),d.vakata.dnd.start(a,z,'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+k+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this));if(this.settings.dnd.use_html5)this.element.on("dragover.jstree",function(a){a.preventDefault();
d.vakata.dnd._trigger("move",a,{helper:d(),element:B,data:z});return!1}).on("drop.jstree",d.proxy(function(a){a.preventDefault();d.vakata.dnd._trigger("stop",a,{helper:d(),element:B,data:z});return!1},this))};this.redraw_node=function(a,d,h,k){if((a=b.redraw_node.apply(this,arguments))&&this.settings.dnd.use_html5)if(this.settings.dnd.large_drag_target)a.setAttribute("draggable",!0);else{var c,e=null;var f=0;for(c=a.childNodes.length;f<c;f++)if(a.childNodes[f]&&a.childNodes[f].className&&-1!==a.childNodes[f].className.indexOf("jstree-anchor")){e=
a.childNodes[f];break}e&&e.setAttribute("draggable",!0)}return a}};d(function(){var a=!1,b=!1,c=!1,e=!1,h=d('<div id="jstree-marker">&#160;</div>').hide();d(t).on("dragover.vakata.jstree",function(a){B&&d.vakata.dnd._trigger("move",a,{helper:d(),element:B,data:z})}).on("drop.vakata.jstree",function(a){B&&(d.vakata.dnd._trigger("stop",a,{helper:d(),element:B,data:z}),z=B=null)}).on("dnd_start.vakata.jstree",function(b,d){c=a=!1;d&&d.data&&d.data.jstree&&h.appendTo(t.body)}).on("dnd_move.vakata.jstree",
function(k,g){var f=g.event.target!==c.target;e&&(!g.event||"dragover"!==g.event.type||f)&&clearTimeout(e);if(g&&g.data&&g.data.jstree&&(!g.event.target.id||"jstree-marker"!==g.event.target.id)){c=g.event;var p=d.jstree.reference(g.event.target),l=!1,r=!1;k=!1;var n,u,t,w,A,y,B,H,z,x,E;if(p&&p._data&&p._data.dnd){h.attr("class","jstree-"+p.get_theme()+(p.settings.core.themes.responsive?" jstree-dnd-responsive":""));var I=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&
(g.event.metaKey||g.event.ctrlKey));g.helper.children().attr("class","jstree-"+p.get_theme()+" jstree-"+p.get_theme()+"-"+p.get_theme_variant()+" "+(p.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[I?"show":"hide"]();if(g.event.target!==p.element[0]&&g.event.target!==p.get_container_ul()[0]||0!==p.get_container_ul().children().length){if((l=p.settings.dnd.large_drop_target?d(g.event.target).closest(".jstree-node").children(".jstree-anchor"):d(g.event.target).closest(".jstree-anchor"))&&
l.length&&l.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")){r=l.offset();k=(g.event.pageY!==q?g.event.pageY:g.event.originalEvent.pageY)-r.top;var G=l.outerHeight();var C=k<G/3?["b","i","a"]:k>G-G/3?["a","i","b"]:k>G/2?["i","a","b"]:["i","b","a"];d.each(C,function(c,k){switch(k){case "b":n=r.left-6;u=r.top;t=p.get_parent(l);w=l.parent().index();break;case "i":z=p.settings.dnd.inside_pos;x=p.get_node(l.parent());n=r.left-2;u=r.top+G/2+1;t=x.id;w="first"===z?0:"last"===z?x.children.length:
Math.min(z,x.children.length);break;case "a":n=r.left-6,u=r.top+G,t=p.get_parent(l),w=l.parent().index()+1}F=!0;D=0;for(A=g.data.nodes.length;D<A;D++)if(y=g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",B=w,"move_node"===y&&"a"===k&&g.data.origin&&g.data.origin===p&&t===p.get_parent(g.data.nodes[D])&&(H=p.get_node(t),B>d.inArray(g.data.nodes[D],H.children)&&--B),F=F&&(p&&p.settings&&p.settings.dnd&&
!1===p.settings.dnd.check_while_dragging||p.check(y,g.data.origin&&g.data.origin!==p?g.data.origin.get_node(g.data.nodes[D]):g.data.nodes[D],t,B,{dnd:!0,ref:p.get_node(l.parent()),pos:k,origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==p,is_foreign:!g.data.origin})),!F){p&&p.last_error&&(b=p.last_error());break}"i"===k&&l.parent().is(".jstree-closed")&&p.settings.dnd.open_timeout&&(!g.event||"dragover"!==g.event.type||f)&&(e&&clearTimeout(e),e=setTimeout(function(a,c){return function(){a.open_node(c)}}(p,
l),p.settings.dnd.open_timeout));if(F)return E=p.get_node(t,!0),E.hasClass(".jstree-dnd-parent")||(d(".jstree-dnd-parent").removeClass("jstree-dnd-parent"),E.addClass("jstree-dnd-parent")),a={ins:p,par:t,pos:"i"!==k||"last"!==z||0!==w||p.is_loaded(x)?w:"last"},h.css({left:n+"px",top:u+"px"}).show(),g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),g.event.originalEvent&&g.event.originalEvent.dataTransfer&&(g.event.originalEvent.dataTransfer.dropEffect=I?"copy":"move"),
b={},C=!0,!1});if(!0===C)return}}else{var F=!0;var D=0;for(A=g.data.nodes.length;D<A&&(F=F&&p.check(g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||g.event.ctrlKey))?"copy_node":"move_node",g.data.origin&&g.data.origin!==p?g.data.origin.get_node(g.data.nodes[D]):g.data.nodes[D],d.jstree.root,"last",{dnd:!0,ref:p.get_node(d.jstree.root),pos:"i",origin:g.data.origin,is_multi:g.data.origin&&g.data.origin!==p,is_foreign:!g.data.origin}),F);D++);
if(F){a={ins:p,par:d.jstree.root,pos:"last"};h.hide();g.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok");g.event.originalEvent&&g.event.originalEvent.dataTransfer&&(g.event.originalEvent.dataTransfer.dropEffect=I?"copy":"move");return}}}d(".jstree-dnd-parent").removeClass("jstree-dnd-parent");a=!1;g.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er");h.hide()}}).on("dnd_scroll.vakata.jstree",function(b,d){d&&d.data&&d.data.jstree&&(h.hide(),
c=a=!1,d.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(k,g){d(".jstree-dnd-parent").removeClass("jstree-dnd-parent");e&&clearTimeout(e);if(g&&g.data&&g.data.jstree){h.hide().detach();var f,p=[];if(a){k=0;for(f=g.data.nodes.length;k<f;k++)p[k]=g.data.origin?g.data.origin.get_node(g.data.nodes[k]):g.data.nodes[k];a.ins[g.data.origin&&(g.data.origin.settings.dnd.always_copy||g.data.origin.settings.dnd.copy&&(g.event.metaKey||
g.event.ctrlKey))?"copy_node":"move_node"](p,a.par,a.pos,!1,!1,!1,g.data.origin)}else k=d(g.event.target).closest(".jstree"),k.length&&b&&b.error&&"check"===b.error&&(k=k.jstree(!0))&&k.settings.core.error.call(this,b);a=c=!1}}).on("keyup.jstree keydown.jstree",function(k,g){(g=d.vakata.dnd._get())&&g.data&&g.data.jstree&&("keyup"===k.type&&27===k.which?(e&&clearTimeout(e),e=c=b=a=!1,h.hide().detach(),d.vakata.dnd._clean()):(g.helper.find(".jstree-copy").first()[g.data.origin&&(g.data.origin.settings.dnd.always_copy||
g.data.origin.settings.dnd.copy&&(k.metaKey||k.ctrlKey))?"show":"hide"](),c&&(c.metaKey=k.metaKey,c.ctrlKey=k.ctrlKey,d.vakata.dnd._trigger("move",c))))})});(function(a){a.vakata.html={div:a("<div />"),escape:function(c){return a.vakata.html.div.text(c).html()},strip:function(c){return a.vakata.html.div.empty().append(a.parseHTML(c)).text()}};var b=!1,c=!1,d=!1,h=!1,k=!1,g=0,f=!1,p=0,l=0,r=0,n=0,u=!1,w=!1,y=!1;a.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,
threshold:5,threshold_touch:10},_trigger:function(c,b,d){d===q&&(d=a.vakata.dnd._get());d.event=b;a(t).triggerHandler("dnd_"+c+".vakata",d)},_get:function(){return{data:f,element:b,helper:k}},_clean:function(){k&&k.remove();w&&(clearInterval(w),w=!1);k=h=d=c=b=!1;g=0;f=!1;n=r=l=p=0;y=w=u=!1;a(t).off("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(t).off("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop)},_scroll:function(c){if(!u||!r&&!n)return w&&(clearInterval(w),
w=!1),!1;if(!w)return w=setInterval(a.vakata.dnd._scroll,100),!1;if(!0===c)return!1;c=u.scrollTop();var b=u.scrollLeft();u.scrollTop(c+n*a.vakata.dnd.settings.scroll_speed);u.scrollLeft(b+r*a.vakata.dnd.settings.scroll_speed);c===u.scrollTop()&&b===u.scrollLeft()||a.vakata.dnd._trigger("scroll",u)},start:function(e,g,m){"touchstart"===e.type&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,
e.target=t.elementFromPoint(e.originalEvent.changedTouches[0].pageX-window.pageXOffset,e.originalEvent.changedTouches[0].pageY-window.pageYOffset));h&&a.vakata.dnd.stop({});try{e.currentTarget.unselectable="on",e.currentTarget.onselectstart=function(){return!1},e.currentTarget.style&&(e.currentTarget.style.touchAction="none",e.currentTarget.style.msTouchAction="none",e.currentTarget.style.MozUserSelect="none")}catch(J){}p=e.pageX;l=e.pageY;f=g;d=!0;b=e.currentTarget;c=e.target;y="touchstart"===e.type;
!1!==m&&(k=a("<div id='vakata-dnd'></div>").html(m).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"}));a(t).on("mousemove.vakata.jstree touchmove.vakata.jstree",a.vakata.dnd.drag);a(t).on("mouseup.vakata.jstree touchend.vakata.jstree",a.vakata.dnd.stop);return!1},drag:function(b){"touchmove"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=
b.originalEvent.changedTouches[0].pageY,b.target=t.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(d){if(!h)if(Math.abs(b.pageX-p)>(y?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold)||Math.abs(b.pageY-l)>(y?a.vakata.dnd.settings.threshold_touch:a.vakata.dnd.settings.threshold))k&&(k.appendTo(t.body),g=k.outerWidth()),h=!0,a(c).one("click.vakata",!1),a.vakata.dnd._trigger("start",b);else return;
var e=!1,f=!1,m=!1,v=!1,q=!1,A=f=!1,w=!1;v=e=!1;r=n=0;u=!1;a(a(b.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(a(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var c=a(this),d=c.offset();this.scrollHeight>this.offsetHeight&&(d.top+c.height()-b.pageY<a.vakata.dnd.settings.scroll_proximity&&(n=1),b.pageY-d.top<a.vakata.dnd.settings.scroll_proximity&&(n=-1));this.scrollWidth>this.offsetWidth&&
(d.left+c.width()-b.pageX<a.vakata.dnd.settings.scroll_proximity&&(r=1),b.pageX-d.left<a.vakata.dnd.settings.scroll_proximity&&(r=-1));if(n||r)return u=a(this),!1});!u&&(e=a(t),f=a(window),m=e.height(),v=f.height(),q=e.width(),f=f.width(),A=e.scrollTop(),w=e.scrollLeft(),m>v&&b.pageY-A<a.vakata.dnd.settings.scroll_proximity&&(n=-1),m>v&&v-(b.pageY-A)<a.vakata.dnd.settings.scroll_proximity&&(n=1),q>f&&b.pageX-w<a.vakata.dnd.settings.scroll_proximity&&(r=-1),q>f&&f-(b.pageX-w)<a.vakata.dnd.settings.scroll_proximity&&
(r=1),n||r)&&(u=e);u&&a.vakata.dnd._scroll(!0);k&&(e=parseInt(b.pageY+a.vakata.dnd.settings.helper_top,10),v=parseInt(b.pageX+a.vakata.dnd.settings.helper_left,10),m&&e+25>m&&(e=m-50),q&&v+g>q&&(v=q-(g+2)),k.css({left:v+"px",top:e+"px"}));a.vakata.dnd._trigger("move",b);return!1}},stop:function(b){"touchend"===b.type&&b.originalEvent&&b.originalEvent.changedTouches&&b.originalEvent.changedTouches[0]&&(b.pageX=b.originalEvent.changedTouches[0].pageX,b.pageY=b.originalEvent.changedTouches[0].pageY,
b.target=t.elementFromPoint(b.originalEvent.changedTouches[0].pageX-window.pageXOffset,b.originalEvent.changedTouches[0].pageY-window.pageYOffset));if(h)b.target!==c&&a(c).off("click.vakata"),a.vakata.dnd._trigger("stop",b);else if("touchend"===b.type&&b.target===c){var d=setTimeout(function(){a(b.target).click()},100);a(b.target).one("click",function(){d&&clearTimeout(d)})}a.vakata.dnd._clean();return!1}}})(d);d.jstree.defaults.massload=null;d.jstree.plugins.massload=function(a,b){this.init=function(a,
d){this._data.massload={};b.init.call(this,a,d)};this._load_nodes=function(a,e,h,k){var c=this.settings.massload;JSON.stringify(a);var f=[],p=this._model.data,l,r;if(!h){var n=0;for(l=a.length;n<l;n++)if(!p[a[n]]||!p[a[n]].state.loaded&&!p[a[n]].state.failed||k)f.push(a[n]),(r=this.get_node(a[n],!0))&&r.length&&r.addClass("jstree-loading").attr("aria-busy",!0);this._data.massload={};if(f.length){if(d.isFunction(c))return c.call(this,f,d.proxy(function(c){if(c)for(d in c)c.hasOwnProperty(d)&&(this._data.massload[d]=
c[d]);var d=0;for(c=a.length;d<c;d++)(r=this.get_node(a[d],!0))&&r.length&&r.removeClass("jstree-loading").attr("aria-busy",!1);b._load_nodes.call(this,a,e,h,k)},this));if("object"===typeof c&&c&&c.url)return c=d.extend(!0,{},c),d.isFunction(c.url)&&(c.url=c.url.call(this,f)),d.isFunction(c.data)&&(c.data=c.data.call(this,f)),d.ajax(c).done(d.proxy(function(c,d,g){if(c)for(f in c)c.hasOwnProperty(f)&&(this._data.massload[f]=c[f]);var f=0;for(c=a.length;f<c;f++)(r=this.get_node(a[f],!0))&&r.length&&
r.removeClass("jstree-loading").attr("aria-busy",!1);b._load_nodes.call(this,a,e,h,k)},this)).fail(d.proxy(function(c){b._load_nodes.call(this,a,e,h,k)},this))}}return b._load_nodes.call(this,a,e,h,k)};this._load_node=function(a,e){var c=this._data.massload[a.id],k=null;return c?(k=this["string"===typeof c?"_append_html_data":"_append_json_data"](a,"string"===typeof c?d(d.parseHTML(c)).filter(function(){return 3!==this.nodeType}):c,function(a){e.call(this,a)}),(c=this.get_node(a.id,!0))&&c.length&&
c.removeClass("jstree-loading").attr("aria-busy",!1),delete this._data.massload[a.id],k):b._load_node.call(this,a,e)}};d.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1};d.jstree.plugins.search=function(a,b){this.bind=function(){b.bind.call(this);this._data.search.str="";this._data.search.dom=d();this._data.search.res=[];this._data.search.opn=[];this._data.search.som=!1;this._data.search.smc=
!1;this._data.search.hdn=[];this.element.on("search.jstree",d.proxy(function(a,b){if(this._data.search.som&&b.res.length){a=this._model.data;var c,e=[],g;var f=0;for(c=b.res.length;f<c;f++)if(a[b.res[f]]&&!a[b.res[f]].state.hidden&&(e.push(b.res[f]),e=e.concat(a[b.res[f]].parents),this._data.search.smc)){var p=0;for(g=a[b.res[f]].children_d.length;p<g;p++)a[a[b.res[f]].children_d[p]]&&!a[a[b.res[f]].children_d[p]].state.hidden&&e.push(a[b.res[f]].children_d[p])}e=d.vakata.array_remove_item(d.vakata.array_unique(e),
d.jstree.root);this._data.search.hdn=this.hide_all(!0);this.show_node(e,!0);this.redraw(!0)}},this)).on("clear_search.jstree",d.proxy(function(a,b){this._data.search.som&&b.res.length&&(this.show_node(this._data.search.hdn,!0),this.redraw(!0))},this))};this.search=function(a,b,h,f,g,m){if(!1===a||""===d.trim(a.toString()))return this.clear_search();f=(f=this.get_node(f))&&f.id?f.id:null;a=a.toString();var c=this.settings.search,e=c.ajax?c.ajax:!1,k=this._model.data,l=null,n=[],t=[],w;this._data.search.res.length&&
!g&&this.clear_search();h===q&&(h=c.show_only_matches);m===q&&(m=c.show_only_matches_children);if(!b&&!1!==e){if(d.isFunction(e))return e.call(this,a,d.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,h,f,g,m)})},this),f);e=d.extend({},e);e.data||(e.data={});e.data.str=a;f&&(e.data.inside=f);this._data.search.lastRequest&&this._data.search.lastRequest.abort();this._data.search.lastRequest=d.ajax(e).fail(d.proxy(function(){this._data.core.last_error=
{error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(e)};this.settings.core.error.call(this,this._data.core.last_error)},this)).done(d.proxy(function(b){b&&b.d&&(b=b.d);this._load_nodes(d.isArray(b)?d.vakata.array_unique(b):[],function(){this.search(a,!0,h,f,g,m)})},this));return this._data.search.lastRequest}g||(this._data.search.str=a,this._data.search.dom=d(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=h,this._data.search.smc=
m);l=new d.vakata.search(a,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy});d.each(k[f?f:d.jstree.root].children_d,function(b,d){b=k[d];b.text&&!b.state.hidden&&(!c.search_leaves_only||b.state.loaded&&0===b.children.length)&&(c.search_callback&&c.search_callback.call(this,a,b)||!c.search_callback&&l.search(b.text).isMatch)&&(n.push(d),t=t.concat(b.parents))});if(n.length){t=d.vakata.array_unique(t);b=0;for(w=t.length;b<w;b++)t[b]!==d.jstree.root&&k[t[b]]&&!0===this.open_node(t[b],null,0)&&this._data.search.opn.push(t[b]);
g?(this._data.search.dom=this._data.search.dom.add(d(this.element[0].querySelectorAll("#"+d.map(n,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=d.vakata.array_unique(this._data.search.res.concat(n))):(this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(n,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,
"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=n);this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")}this.trigger("search",{nodes:this._data.search.dom,str:a,res:this._data.search.res,show_only_matches:h})};this.clear_search=function(){this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0);this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res});this._data.search.res.length&&
(this._data.search.dom=d(this.element[0].querySelectorAll("#"+d.map(this._data.search.res,function(a){return-1!=="0123456789".indexOf(a[0])?"\\3"+a[0]+" "+a.substr(1).replace(d.jstree.idregex,"\\$&"):a.replace(d.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"));this._data.search.str="";this._data.search.res=[];this._data.search.opn=[];this._data.search.dom=d()};this.redraw_node=function(a,e,h,f){if((a=b.redraw_node.apply(this,arguments))&&
-1!==d.inArray(a.id,this._data.search.res)){var c,k=null;var p=0;for(c=a.childNodes.length;p<c;p++)if(a.childNodes[p]&&a.childNodes[p].className&&-1!==a.childNodes[p].className.indexOf("jstree-anchor")){k=a.childNodes[p];break}k&&(k.className+=" jstree-search")}return a}};(function(a){a.vakata.search=function(b,c,d){d=d||{};d=a.extend({},a.vakata.search.defaults,d);!1!==d.fuzzy&&(d.fuzzy=!0);b=d.caseSensitive?b:b.toLowerCase();var e=d.location,f=d.distance,g=d.threshold,m=b.length;32<m&&(d.fuzzy=
!1);if(d.fuzzy){var p=1<<m-1;var l=function(){var a={},c;for(c=0;c<m;c++)a[b.charAt(c)]=0;for(c=0;c<m;c++)a[b.charAt(c)]|=1<<m-c-1;return a}();var n=function(a,b){a/=m;b=Math.abs(e-b);return f?a+b/f:b?1:a}}var q=function(a){a=d.caseSensitive?a:a.toLowerCase();if(b===a||-1!==a.indexOf(b))return{isMatch:!0,score:0};if(!d.fuzzy)return{isMatch:!1,score:1};var c,h=a.length,f=g,k=a.indexOf(b,e),r,q=m+h,v=1,t=[];-1!==k&&(f=Math.min(n(0,k),f),k=a.lastIndexOf(b,e+m),-1!==k&&(f=Math.min(n(0,k),f)));k=-1;for(c=
0;c<m;c++){var w=0;for(r=q;w<r;)n(c,e+r)<=f?w=r:q=r,r=Math.floor((q-w)/2+w);q=r;w=Math.max(1,e-r+1);var u=Math.min(e+r,h)+m;r=Array(u+2);for(r[u+1]=(1<<c)-1;u>=w;u--){var y=l[a.charAt(u-1)];r[u]=0===c?(r[u+1]<<1|1)&y:(r[u+1]<<1|1)&y|(B[u+1]|B[u])<<1|1|B[u+1];if(r[u]&p&&(v=n(c,u-1),v<=f))if(f=v,k=u-1,t.push(k),k>e)w=Math.max(1,2*e-k);else break}if(n(c+1,e)>f)break;var B=r}return{isMatch:0<=k,score:v}};return!0===c?{search:q}:q(c)};a.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,
caseSensitive:!1}})(d);d.jstree.defaults.sort=function(a,b){return this.get_text(a)>this.get_text(b)?1:-1};d.jstree.plugins.sort=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("model.jstree",d.proxy(function(a,b){this.sort(b.parent,!0)},this)).on("rename_node.jstree create_node.jstree",d.proxy(function(a,b){this.sort(b.parent||b.node.parent,!1);this.redraw_node(b.parent||b.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",d.proxy(function(a,b){this.sort(b.parent,
!1);this.redraw_node(b.parent,!0)},this))};this.sort=function(a,b){var c;if((a=this.get_node(a))&&a.children&&a.children.length&&(a.children.sort(d.proxy(this.settings.sort,this)),b))for(b=0,c=a.children_d.length;b<c;b++)this.sort(a.children_d[b],!1)}};var E=!1;d.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1,preserve_loaded:!1};d.jstree.plugins.state=function(a,b){this.bind=function(){b.bind.call(this);
var a=d.proxy(function(){this.element.on(this.settings.state.events,d.proxy(function(){E&&clearTimeout(E);E=setTimeout(d.proxy(function(){this.save_state()},this),100)},this));this.trigger("state_ready")},this);this.element.on("ready.jstree",d.proxy(function(b,c){this.element.one("restore_state.jstree",a);this.restore_state()||a()},this))};this.save_state=function(){var a=this.get_state();this.settings.state.preserve_loaded||delete a.core.loaded;d.vakata.storage.set(this.settings.state.key,JSON.stringify({state:a,
ttl:this.settings.state.ttl,sec:+new Date}))};this.restore_state=function(){var a=d.vakata.storage.get(this.settings.state.key);if(a)try{a=JSON.parse(a)}catch(e){return!1}if(a&&a.ttl&&a.sec&&+new Date-a.sec>a.ttl)return!1;a&&a.state&&(a=a.state);a&&d.isFunction(this.settings.state.filter)&&(a=this.settings.state.filter.call(this,a));return a?(this.settings.state.preserve_loaded||delete a.core.loaded,this.element.one("set_state.jstree",function(b,c){c.instance.trigger("restore_state",{state:d.extend(!0,
{},a)})}),this.set_state(a),!0):!1};this.clear_state=function(){return d.vakata.storage.del(this.settings.state.key)}};(function(a,b){a.vakata.storage={set:function(a,b){return window.localStorage.setItem(a,b)},get:function(a){return window.localStorage.getItem(a)},del:function(a){return window.localStorage.removeItem(a)}}})(d);d.jstree.defaults.types={"default":{}};d.jstree.defaults.types[d.jstree.root]={};d.jstree.plugins.types=function(a,b){this.init=function(a,e){var c,f;if(e&&e.types&&e.types["default"])for(c in e.types)if("default"!==
c&&c!==d.jstree.root&&e.types.hasOwnProperty(c))for(f in e.types["default"])e.types["default"].hasOwnProperty(f)&&e.types[c][f]===q&&(e.types[c][f]=e.types["default"][f]);b.init.call(this,a,e);this._model.data[d.jstree.root].type=d.jstree.root};this.refresh=function(a,e){b.refresh.call(this,a,e);this._model.data[d.jstree.root].type=d.jstree.root};this.bind=function(){this.element.on("model.jstree",d.proxy(function(a,b){a=this._model.data;b=b.nodes;var c=this.settings.types,e,g;var f=0;for(e=b.length;f<
e;f++){var p="default";a[b[f]].original&&a[b[f]].original.type&&c[a[b[f]].original.type]&&(p=a[b[f]].original.type);a[b[f]].data&&a[b[f]].data.jstree&&a[b[f]].data.jstree.type&&c[a[b[f]].data.jstree.type]&&(p=a[b[f]].data.jstree.type);a[b[f]].type=p;!0===a[b[f]].icon&&c[p].icon!==q&&(a[b[f]].icon=c[p].icon);if(c[p].li_attr!==q&&"object"===typeof c[p].li_attr)for(g in c[p].li_attr)c[p].li_attr.hasOwnProperty(g)&&"id"!==g&&(a[b[f]].li_attr[g]===q?a[b[f]].li_attr[g]=c[p].li_attr[g]:"class"===g&&(a[b[f]].li_attr["class"]=
c[p].li_attr["class"]+" "+a[b[f]].li_attr["class"]));if(c[p].a_attr!==q&&"object"===typeof c[p].a_attr)for(g in c[p].a_attr)c[p].a_attr.hasOwnProperty(g)&&"id"!==g&&(a[b[f]].a_attr[g]===q?a[b[f]].a_attr[g]=c[p].a_attr[g]:"href"===g&&"#"===a[b[f]].a_attr[g]?a[b[f]].a_attr.href=c[p].a_attr.href:"class"===g&&(a[b[f]].a_attr["class"]=c[p].a_attr["class"]+" "+a[b[f]].a_attr["class"]))}a[d.jstree.root].type=d.jstree.root},this));b.bind.call(this)};this.get_json=function(a,e,h){var c=this._model.data,g=
e?d.extend(!0,{},e,{no_id:!1}):{};g=b.get_json.call(this,a,g,h);if(!1===g)return!1;if(d.isArray(g))for(a=0,h=g.length;a<h;a++)g[a].type=g[a].id&&c[g[a].id]&&c[g[a].id].type?c[g[a].id].type:"default",e&&e.no_id&&(delete g[a].id,g[a].li_attr&&g[a].li_attr.id&&delete g[a].li_attr.id,g[a].a_attr&&g[a].a_attr.id&&delete g[a].a_attr.id);else g.type=g.id&&c[g.id]&&c[g.id].type?c[g.id].type:"default",e&&e.no_id&&(g=this._delete_ids(g));return g};this._delete_ids=function(a){if(d.isArray(a)){for(var b=0,c=
a.length;b<c;b++)a[b]=this._delete_ids(a[b]);return a}delete a.id;a.li_attr&&a.li_attr.id&&delete a.li_attr.id;a.a_attr&&a.a_attr.id&&delete a.a_attr.id;a.children&&d.isArray(a.children)&&(a.children=this._delete_ids(a.children));return a};this.check=function(a,e,h,f,g){if(!1===b.check.call(this,a,e,h,f,g))return!1;e=e&&e.id?e:this.get_node(e);h=h&&h.id?h:this.get_node(h);g=e&&e.id?g&&g.origin?g.origin:d.jstree.reference(e.id):null;var c,k;g=g&&g._model&&g._model.data?g._model.data:null;switch(a){case "create_node":case "move_node":case "copy_node":if("move_node"!==
a||-1===d.inArray(e.id,h.children)){var l=this.get_rules(h);if(l.max_children!==q&&-1!==l.max_children&&l.max_children===h.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:e&&e.id?e.id:!1,par:h&&h.id?h.id:!1})},!1;if(l.valid_children!==q&&-1!==l.valid_children&&-1===d.inArray(e.type||"default",l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",
id:"types_02",reason:"valid_children prevents function: "+a,data:JSON.stringify({chk:a,pos:f,obj:e&&e.id?e.id:!1,par:h&&h.id?h.id:!1})},!1;if(g&&e.children_d&&e.parents){var n=c=0;for(k=e.children_d.length;n<k;n++)c=Math.max(c,g[e.children_d[n]].parents.length);c=c-e.parents.length+1}if(0>=c||c===q)c=1;do{if(l.max_depth!==q&&-1!==l.max_depth&&l.max_depth<c)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+a,data:JSON.stringify({chk:a,
pos:f,obj:e&&e.id?e.id:!1,par:h&&h.id?h.id:!1})},!1;h=this.get_node(h.parent);l=this.get_rules(h);c++}while(h)}}return!0};this.get_rules=function(a){a=this.get_node(a);if(!a)return!1;a=this.get_type(a,!0);a.max_depth===q&&(a.max_depth=-1);a.max_children===q&&(a.max_children=-1);a.valid_children===q&&(a.valid_children=-1);return a};this.get_type=function(a,b){return(a=this.get_node(a))?b?d.extend({type:a.type},this.settings.types[a.type]):a.type:!1};this.set_type=function(a,b){var c=this._model.data,
e,g,f,l;if(d.isArray(a)){a=a.slice();c=0;for(e=a.length;c<e;c++)this.set_type(a[c],b);return!0}e=this.settings.types;a=this.get_node(a);if(!e[b]||!a)return!1;(f=this.get_node(a,!0))&&f.length&&(l=f.children(".jstree-anchor"));var n=a.type;var r=this.get_icon(a);a.type=b;(!0===r||!e[n]||e[n].icon!==q&&r===e[n].icon)&&this.set_icon(a,e[b].icon!==q?e[b].icon:!0);if(e[n]&&e[n].li_attr!==q&&"object"===typeof e[n].li_attr)for(g in e[n].li_attr)e[n].li_attr.hasOwnProperty(g)&&"id"!==g&&("class"===g?(c[a.id].li_attr["class"]=
(c[a.id].li_attr["class"]||"").replace(e[n].li_attr[g],""),f&&f.removeClass(e[n].li_attr[g])):c[a.id].li_attr[g]===e[n].li_attr[g]&&(c[a.id].li_attr[g]=null,f&&f.removeAttr(g)));if(e[n]&&e[n].a_attr!==q&&"object"===typeof e[n].a_attr)for(g in e[n].a_attr)e[n].a_attr.hasOwnProperty(g)&&"id"!==g&&("class"===g?(c[a.id].a_attr["class"]=(c[a.id].a_attr["class"]||"").replace(e[n].a_attr[g],""),l&&l.removeClass(e[n].a_attr[g])):c[a.id].a_attr[g]===e[n].a_attr[g]&&("href"===g?(c[a.id].a_attr[g]="#",l&&l.attr("href",
"#")):(delete c[a.id].a_attr[g],l&&l.removeAttr(g))));if(e[b].li_attr!==q&&"object"===typeof e[b].li_attr)for(g in e[b].li_attr)e[b].li_attr.hasOwnProperty(g)&&"id"!==g&&(c[a.id].li_attr[g]===q?(c[a.id].li_attr[g]=e[b].li_attr[g],f&&("class"===g?f.addClass(e[b].li_attr[g]):f.attr(g,e[b].li_attr[g]))):"class"===g&&(c[a.id].li_attr["class"]=e[b].li_attr[g]+" "+c[a.id].li_attr["class"],f&&f.addClass(e[b].li_attr[g])));if(e[b].a_attr!==q&&"object"===typeof e[b].a_attr)for(g in e[b].a_attr)e[b].a_attr.hasOwnProperty(g)&&
"id"!==g&&(c[a.id].a_attr[g]===q?(c[a.id].a_attr[g]=e[b].a_attr[g],l&&("class"===g?l.addClass(e[b].a_attr[g]):l.attr(g,e[b].a_attr[g]))):"href"===g&&"#"===c[a.id].a_attr[g]?(c[a.id].a_attr.href=e[b].a_attr.href,l&&l.attr("href",e[b].a_attr.href)):"class"===g&&(c[a.id].a_attr["class"]=e[b].a_attr["class"]+" "+c[a.id].a_attr["class"],l&&l.addClass(e[b].a_attr[g])));return!0}};d.jstree.defaults.unique={case_sensitive:!1,trim_whitespace:!1,duplicate:function(a,b){return a+" ("+b+")"}};d.jstree.plugins.unique=
function(a,b){this.check=function(a,e,f,k,g){if(!1===b.check.call(this,a,e,f,k,g))return!1;e=e&&e.id?e:this.get_node(e);f=f&&f.id?f:this.get_node(f);if(!f||!f.children)return!0;var c="rename_node"===a?k:e.text,h=[],l=this.settings.unique.case_sensitive,n=this.settings.unique.trim_whitespace,q=this._model.data,t;var w=0;for(t=f.children.length;w<t;w++){var y=q[f.children[w]].text;l||(y=y.toLowerCase());n&&(y=y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));h.push(y)}l||(c=c.toLowerCase());n&&(c=
c.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));switch(a){case "rename_node":return y=e.text||"",l||(y=y.toLowerCase()),n&&(y=y.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")),w=-1===d.inArray(c,h)||e.text&&y===c,w||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+c+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:k,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),w;case "create_node":return w=-1===d.inArray(c,h),w||(this._data.core.last_error=
{error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+c+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:k,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),w;case "copy_node":return w=-1===d.inArray(c,h),w||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+c+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:k,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),w;case "move_node":return w=e.parent===f.id&&(!g||!g.is_multi)||
-1===d.inArray(c,h),w||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+c+" already exists. Preventing: "+a,data:JSON.stringify({chk:a,pos:k,obj:e&&e.id?e.id:!1,par:f&&f.id?f.id:!1})}),w}return!0};this.create_node=function(a,e,f,k,g){if(!e||e.text===q){null===a&&(a=d.jstree.root);a=this.get_node(a);if(!a)return b.create_node.call(this,a,e,f,k,g);f=f===q?"last":f;if(!f.toString().match(/^(before|after)$/)&&!g&&!this.is_loaded(a))return b.create_node.call(this,
a,e,f,k,g);e||(e={});var c,h,l=this._model.data,n=this.settings.unique.case_sensitive,w=this.settings.unique.trim_whitespace,t=this.settings.unique.duplicate;var y=c=this.get_string("New node");var B=[];var z=0;for(h=a.children.length;z<h;z++){var x=l[a.children[z]].text;n||(x=x.toLowerCase());w&&(x=x.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));B.push(x)}z=1;x=y;n||(x=x.toLowerCase());for(w&&(x=x.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));-1!==d.inArray(x,B);)x=y=t.call(this,c,++z).toString(),
n||(x=x.toLowerCase()),w&&(x=x.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""));e.text=y}return b.create_node.call(this,a,e,f,k,g)}};var C=t.createElement("DIV");C.setAttribute("unselectable","on");C.setAttribute("role","presentation");C.className="jstree-wholerow";C.innerHTML="&#160;";d.jstree.plugins.wholerow=function(a,b){this.bind=function(){b.bind.call(this);this.element.on("ready.jstree set_state.jstree",d.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",
d.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",d.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",d.proxy(function(a,b){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var c;var d=0;for(c=b.selected.length;d<c;d++)(a=this.get_node(b.selected[d],!0))&&a.length&&a.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},
this)).on("open_node.jstree",d.proxy(function(a,b){this.get_node(b.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",d.proxy(function(a,b){if("hover_node"!==a.type||!this.is_disabled(b.node))this.get_node(b.node,!0).children(".jstree-wholerow")["hover_node"===a.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",d.proxy(function(a){if(this._data.contextmenu){a.preventDefault();
var b=d.Event("contextmenu",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey,pageX:a.pageX,pageY:a.pageY});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b)}},this)).on("click.jstree",".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()}).on("dblclick.jstree",
".jstree-wholerow",function(a){a.stopImmediatePropagation();var b=d.Event("dblclick",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",d.proxy(function(a){a.stopImmediatePropagation();var b=d.Event("click",{metaKey:a.metaKey,ctrlKey:a.ctrlKey,altKey:a.altKey,shiftKey:a.shiftKey});d(a.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(b).focus()},
this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",d.proxy(function(a){a.stopImmediatePropagation();this.is_disabled(a.currentTarget)||this.hover_node(a.currentTarget);return!1},this)).on("mouseleave.jstree",".jstree-node",d.proxy(function(a){this.dehover_node(a.currentTarget)},this))};this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove();b.teardown.call(this)};this.redraw_node=function(a,e,f,k){if(a=b.redraw_node.apply(this,arguments)){var c=C.cloneNode(!0);
-1!==d.inArray(a.id,this._data.core.selected)&&(c.className+=" jstree-wholerow-clicked");this._data.core.focused&&this._data.core.focused===a.id&&(c.className+=" jstree-wholerow-hovered");a.insertBefore(c,a.childNodes[0])}return a}};if(window.customElements&&Object&&Object.create){y=Object.create(HTMLElement.prototype);y.createdCallback=function(){var a={core:{},plugins:[]},b;for(b in d.jstree.plugins)d.jstree.plugins.hasOwnProperty(b)&&this.attributes[b]&&(a.plugins.push(b),this.getAttribute(b)&&
JSON.parse(this.getAttribute(b))&&(a[b]=JSON.parse(this.getAttribute(b))));for(b in d.jstree.defaults.core)d.jstree.defaults.core.hasOwnProperty(b)&&this.attributes[b]&&(a.core[b]=JSON.parse(this.getAttribute(b))||this.getAttribute(b));d(this).jstree(a)};try{window.customElements.define("vakata-jstree",function(){},{prototype:y})}catch(a){}}}});
(function(d,q){var x=0;d.widget("s3.hierarchicalopts",{options:{selected:null,multiple:!0,leafonly:!0,cascade:!1,bulkSelect:!1,cascadeOptionInTree:!0,noneSelectedText:"Select",selectedText:"selected",noOptionsText:"No options available",selectAllText:"Select All",deselectAllText:"Deselect All",icons:!1,stripes:!0,htmlTitles:!0},_create:function(){var f=d(this.element),l=this.options;this.id=x;x+=1;this._namespace=".hierarchicalopts"+x;this.treeID=f.attr("id")+"-tree";this.input=f.find(".s3-hierarchy-input").first();
this.input.data("input",!0);var n=l.selected;n&&this.input.val(this._stringifySelection(n));this.button=d('<button type="button" class="s3-hierarchy-button ui-multiselect ui-widget ui-state-default ui-corner-all"><span class="ui-icon ui-icon-triangle-1-s"></span></button>');this.buttonText=d("<span>"+l.noneSelectedText+"</span>").appendTo(this.button);this.noopts=d('<span class="no-options-available">'+l.noOptionsText+"</span>").hide();this.tree=f.find(".s3-hierarchy-tree").first();this.wrapper=this.tree.closest(".s3-hierarchy-wrapper").hide().before(this.noopts).before(this.button).detach().appendTo("body");
this.manualCascadeOption=this._isBulk=this._isOpen=!1},_init:function(){this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this);this._unbindEvents();d(this.button).remove();d(this.noopts).remove();d(this.tree).detach().appendTo(this.element).show()},refresh:function(){this._unbindEvents();var f=this.options,l=this.tree,n=this;if(l.find("li").length){this.noopts.hide();this.button.show();this.input.next(".error_wrapper").insertAfter(this.button).one("click",function(){d(this).fadeOut()});
var q=this.input.val();if(q){q=this._parseSelection(q);var y=this.treeID;d.each(q,function(){d("#"+y+"-"+this).data("jstree",{selected:!0})})}q=l.find("> ul > li");if(1==q.length){q=q.first();var t=q.data("jstree");q.data("jstree",d.extend({},t,{opened:!0}))}q=f.multiple;t=f.leafonly;var x=f.cascade,z=!1,B=null,E=["sort","checkbox"];this.input.data("multiple",q);(x||t)&&q?z=!0:q&&(f.cascadeOptionInTree?this.manualCascadeOption=!0:(B=function(a){return l.jstree("is_parent",a)?(d.vakata.context.settings.icons=
!1,{select_all:{label:n.options.selectAllText,icon:!1,action:function(b){n._selectBranch(a)}},deselect_all:{label:n.options.deselectAllText,icon:!1,action:function(b){n._deselectBranch(a)}}}):null},E.push("contextmenu")));l.jstree({core:{themes:{name:"s3",icons:f.icons,stripes:f.stripes},animation:100,multiple:q,check_callback:!0},checkbox:{three_state:z},sort:function(a,b){var c=this.get_text(a)>this.get_text(b)?1:-1;try{var d=this.get_node(a).li_attr.rel}catch(k){d=null}try{var f=this.get_node(b).li_attr.rel}catch(k){f=
null}return"bulk"==d?-1:"bulk"==f?1:"none"==d?-1:"none"==f?1:c},contextmenu:{items:B,select_node:!1,icons:!1},plugins:E});var C=jQuery.jstree.reference(l);q&&((f.bulkSelect||this.manualCascadeOption)&&f.cascadeOptionInTree?(this.wrapper.find(".s3-hierarchy-header").hide(),C.create_node("#",{id:this.treeID+"-select-all",text:f.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first")):this.wrapper.find(".s3-hierarchy-header").removeClass("hide").show());l.on("ready.jstree",function(){var a=
C.get_checked();n._updateButtonText(a)});this._bindEvents()}else this.button.hide(),this.noopts.show()},_setOption:function(f,l){if("selected"===f){var n=jQuery.jstree.reference(d(this.tree));if(n&&(n.uncheck_all(),l)){this.input.val(this._stringifySelection(l));var q=this.treeID;d.each(l,function(){n.check_node("#"+q+"-"+this)});this._updateButtonText(l)}}this._super(f,l)},_updateSelectedNodes:function(){var f=jQuery.jstree.reference(d(this.tree)),l=this._parseSelection(this.input.val()),n=[],q=
[],y=this.options.leafonly,t=f.get_checked(!0);d(t).each(function(){var l=d(this).attr("id");if("bulk"!=d(this).attr("rel")&&l&&(!y||f.is_leaf(this))){var t=l.split("-").pop();"None"!=t&&(t=parseInt(t));t&&(n.push(t),q.push(l))}});t=!1;var x=d(n).not(l).get();x.length?t=!0:(x=d(l).not(n).get(),x.length&&(t=!0));l=this.input.val(this._stringifySelection(n));this._updateButtonText(q);t&&(l.change(),d(this.element).trigger("select.s3hierarchy"));return!0},_updateButtonText:function(f){var l=this.options,
n=0;f&&(n=f.length);if(n)if(1<n)f=l.selectedText.replace("#",n);else{for(var q=[],y=0;y<n;y++)q.push(d("#"+f[y]+" > a").text().replace(/^\s+|\s+$/g,""));f=q.length?q.join(" "):l.noneSelectedText}else f=l.noneSelectedText;this.buttonText.text(f)},_updateAndClose:function(){if(!this._isBulk){this._updateSelectedNodes();var d=this.wrapper,l=this;if(l.options.multiple)d.unbind("mouseleave.hierarchicalopts").one("mouseleave.hierarchicalopts",function(){window.setTimeout(function(){l.closeMenu()},100)});
else window.setTimeout(function(){l.closeMenu()},100)}},_selectNode:function(f){var l=this.options,n=jQuery.jstree.reference(d(this.tree)),q=l.multiple,y=l.leafonly;if(q)this._isBulk||"bulk"!=f.li_attr.rel||((l=n.get_parent(f))&&"#"!=l?(l=n.get_node(l),this._selectBranch(l,!0)):n.select_all());else{var t=f.id;d(n.get_checked(!0)).each(function(){t==this.id||y&&!n.is_leaf(this)||n.uncheck_node(this)})}if(y&&!q&&!n.is_leaf(f))return n.deselect_node(f),!1;this._updateAndClose()},_deselectNode:function(f){var l=
jQuery.jstree.reference(d(this.tree));if(!this._isBulk){if("bulk"==f.li_attr.rel)(f=l.get_parent(f))&&"#"!=f?(f=l.get_node(f),this._deselectBranch(f,!0)):l.deselect_all();else if(f=l.get_parent(f))if(f=l.get_node(f+"-select-all"))this._isBulk=!0,l.uncheck_node(f),this._isBulk=!1;if(f=l.get_node(this.treeID+"-select-all"))this._isBulk=!0,l.uncheck_node(f),this._isBulk=!1}this._updateSelectedNodes()},_openNode:function(f){var l=jQuery.jstree.reference(d(this.tree)),n=l.get_parent(f);n.length&&l.open_node(n,
!1,!0);if(this.manualCascadeOption){var q=f.id;n=l.get_node(q+"-select-all");n||(f=l.create_node(f,{id:q+"-select-all",text:this.options.selectAllText,li_attr:{rel:"bulk","class":"s3-hierarchy-action-node"}},"first"),n=l.get_node(f));(f=l.get_node(this.treeID+"-select-all"))&&l.is_checked(f)&&(this._isBulk=!0,l.check_node(n),this._isBulk=!1)}},_selectBranch:function(f,l){var n=jQuery.jstree.reference(d(this.tree)),q=this;this._isBulk=!0;n.open_node(f,function(){var w=n.get_children_dom(f);d(w).each(function(){q._selectBranch(this)});
l||n.check_node(f)});this._isBulk=!1;this._updateAndClose()},_deselectBranch:function(f,l){var n=jQuery.jstree.reference(d(this.tree)),q=this;this._isBulk=!0;n.open_node(f,function(){var w=n.get_children_dom(f);d(w).each(function(){q._deselectBranch(this)});l||n.uncheck_node(f)});this._isBulk=!1;this._updateSelectedNodes()},set:function(f){var l=jQuery.jstree.reference(d(this.tree)),n=this.treeID;this._isBulk=!0;l.uncheck_all();l.close_all();if(f){var q=function(d,f){if(d=l.get_parent(d))"#"!=d?(q(d),
l.open_node(d,f)):f&&f()};f.forEach(function(d){var f=l.get_node(n+"-"+d);f&&q(f,function(){l.check_node(f)})})}this._isBulk=!1;this._updateSelectedNodes()},get:function(){return this._parseSelection(this.input.val())},reset:function(){var f=jQuery.jstree.reference(d(this.tree));this._isBulk=!0;f.uncheck_all();f.close_all();this._isBulk=!1;this._updateSelectedNodes();return!0},_setMenuPosition:function(f,l){var n=l.offset(),q={position:"absolute",top:n.top+l.outerHeight(),minWidth:l.outerWidth()-
8};"rtl"===d("body").css("direction")?q.right=d(window).width()-(n.left+l.outerWidth()):q.left=n.left;f.css(q)},openMenu:function(){this._isOpen&&this.closeMenu();var f=d(this.button),l=d(this.wrapper),n=this;this._setMenuPosition(l,f);d(window).on("resize"+this._namespace+"-mpos",function(){n._setMenuPosition(l,f)});l.show();d(this.tree).jstree("set_focus");this._isOpen=!0;f.addClass("ui-state-active");d(this).trigger("open")},closeMenu:function(){d(window).off(this._namespace+"-mpos");d(this.tree).jstree("unset_focus").unbind("click.hierarchicalopts").unbind("mouseleave.hierarchicalopts");
d(this.wrapper).fadeOut(50);this._isOpen=!1;d(this.button).removeClass("ui-state-active");d(this).trigger("close")},addNode:function(f,l,n,q){var w=this.tree,t=this.treeID,x="#";f&&(x=d("#"+t+"-"+f),x.length||(x="#"));l=t+"-"+l;w.jstree("create_node",x,{id:l,text:n,li_attr:{rel:"leaf"}},"last");f&&(x.attr({rel:"parent"}),w.jstree("open_node",x));q&&w.jstree("check_node",d("#"+l))},_parseSelection:function(d){if(d)d=JSON.parse(d);else return[];d?d.constructor!==Array&&(d=[d]):d=[];return d},_stringifySelection:function(d){if(!this.options.multiple)if(d.length)d=
d[0];else return"";return JSON.stringify(d)},_bindEvents:function(){var f=this,l=d(this.wrapper),n=d(this.tree),q=d(this.button),y=this._namespace,t=this.options,x=jQuery.jstree.reference(n),z=d.vakata.context.settings.icons;d(document).bind("context_show.vakata",function(){l.unbind("mouseleave.hierarchicalopts");d.vakata.context.settings.icons=z});n.bind("select_node.jstree",function(d,l){f._selectNode(l.node)}).bind("deselect_node.jstree",function(d,l){f._deselectNode(l.node)}).bind("open_node.jstree",
function(d,l){f._openNode(l.node)});q.bind("click"+y,function(){f._isOpen?f.closeMenu():f.openMenu()}).bind("keyup"+y,function(d){d.preventDefault();switch(d.keyCode){case 27:case 38:case 37:f.closeMenu();break;case 39:case 40:f.openMenu()}}).bind("mouseenter"+y,function(){q.hasClass("ui-state-disabled")||d(this).addClass("ui-state-hover")}).bind("mouseleave"+y,function(){d(this).removeClass("ui-state-hover")}).bind("focus"+y,function(){q.hasClass("ui-state-disabled")||d(this).addClass("ui-state-focus")}).bind("blur"+
y,function(){d(this).removeClass("ui-state-focus")});t.multiple&&t.bulkSelect&&!t.cascadeOptionInTree&&(l.find(".s3-hierarchy-select-all").bind("click"+y,function(d){d.preventDefault();x.select_all();f._updateSelectedNodes()}),l.find(".s3-hierarchy-deselect-all").bind("click"+y,function(d){d.preventDefault();x.deselect_all();f._updateSelectedNodes()}),l.find(".s3-hierarchy-header").bind("click"+y,function(d){d.preventDefault();d.stopPropagation()}).bind("mousedown"+y,function(d){d.preventDefault();
d.stopPropagation()}));d(document).bind("mousedown"+y,function(t){var w=t.target;if(d(".jstree-contextmenu").has(w).length||3==t.which)return l.unbind("mouseleave.hierarchicalopts"),!0;n.is(w)||q.is(w)||0!==n.has(w).length||0!==q.has(w).length||f.closeMenu()});return!0},_unbindEvents:function(){var f=d(this.tree);d(this.button);var l=this._namespace;f.unbind("select_node.jstree").unbind("deselect_node.jstree").unbind("loaded.jstree").unbind("open_node.jstree");d(this.button).unbind(l);d(document).unbind(l);
return!0}})})(jQuery);
(function(d,q){var x=0;d.widget("s3.hierarchicalcrud",{options:{widgetID:null,ajaxURL:null,openLabel:"Open",openURL:null,editTitle:"Edit Record",editLabel:"Edit",editURL:null,deleteLabel:"Delete",deleteURL:null,deleteRoot:!0,addTitle:"Add Record",addLabel:"Add",addURL:null,icons:!1,stripes:!0,htmlTitles:!0},_create:function(){this.treeID=d(this.element).attr("id")+"-tree";this.id=x;x+=1},_init:function(){this.tree=d(this.element).find(".s3-hierarchy-tree");this.refresh()},_destroy:function(){d.Widget.prototype.destroy.call(this)},refresh:function(){var f=
this.tree,l=this.options;this._unbindEvents();var n=f.find("> ul > li");if(1==n.length){n=n.first();var q=n.data("jstree");n.data("jstree",d.extend({},q,{opened:!0}))}var y=this;f.jstree({core:{themes:{name:"s3",icons:l.icons,stripes:l.stripes},animation:100,multiple:!1,check_callback:!0},contextmenu:{items:function(d){var n=!0;"#"==f.jstree(!0).get_parent(d)&&(n=l.deleteRoot);var q={open:{label:y.options.openLabel,action:function(f){y._openNode(d)},separator_after:!0}};l.editURL&&(q.edit={label:y.options.editLabel,
action:function(f){y._editNode(d)}});n&&l.deleteURL&&(q.delete={label:y.options.deleteLabel,separator_after:!0,action:function(f){y._deleteNode(d)}});l.addURL&&(q.add={label:y.options.addLabel,action:function(f){y._addNode(d)}});return q},select_node:!0},plugins:["sort","contextmenu"]});this._bindEvents()},_openNode:function(d){var f=this.options.openURL;d=d.id;f&&d&&(d=parseInt(d.split("-").pop()))&&(f=f.replace("[id]",d).replace("%5Bid%5D",d),window.location.href=f)},refreshNode:function(f){var l=
this.options.ajaxURL,n=f.attr("id");if(l&&n&&(n=parseInt(n.split("-").pop()))){var q=this.tree,y=this.treeID;d.getJSONS3(l+"?node="+n,function(d){d.label&&q.jstree("rename_node",f,d.label);if(d=d.children){q.jstree("open_node",f,!1,!1);for(var l,n,t,w=0,x=0,a=d.length;x<a;x++)l=d[x],n=y+"-"+l.node,(t=q.jstree("get_node","#"+n,!0))?q.jstree("rename_node",t,l.label):(q.jstree("create_node",f,{id:n,text:l.label,li_attr:{rel:"leaf"}}),w++);w&&(q.jstree("open_node",f),f.attr({rel:"parent"}))}})}},_editNode:function(f){var l=
this.options.editURL;f=f.id;if(l&&f){var n=parseInt(f.split("-").pop());n&&(l=l.replace("[id]",n).replace("%5Bid%5D",n).split("?")[0],l+="?node="+f+"&hierarchy="+this.options.widgetID,f=S3.uid(),l=d('<iframe id="'+f+'" src='+l+" onload=\"S3.popup_loaded('"+f+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(l,this.options.editTitle))}},_addNode:function(f){var l=this.options.addURL;f=f.id;if(l&&f){var n=parseInt(f.split("-").pop());
n&&(l=l.split("?")[0],l+="?node="+f+"&link_to_parent="+n+"&hierarchy="+this.options.widgetID,f=S3.uid(),l=d('<iframe id="'+f+'" src='+l+" onload=\"S3.popup_loaded('"+f+'\')" class="loading" marginWidth="0" marginHeight="0" frameBorder="0"></iframe>').appendTo("body"),this._openPopup(l,this.options.addTitle))}},_deleteNode:function(f){if(!confirm(i18n.delete_confirmation))return!1;var l=this.options.deleteURL,n=f.id,q=this.tree;l&&n&&(n=parseInt(n.split("-").pop()))&&(l=l.replace("[id]",n).replace("%5Bid%5D",
n).split("?")[0],d.ajaxS3({type:"POST",url:l+"?recursive=1",data:{},dataType:"JSON",success:function(d){q.jstree("delete_node",f)},error:function(d,f,l){f=d.responseText;if("{"==f[0])try{f=JSON.parse(d.responseText),S3.showAlert(f.message,"error")}catch(z){}}}))},_openPopup:function(f,l){f.dialog({close:function(d,l){if(self.parent){var n=self.parent.$("iframe.ui-dialog-content"),q=n.width();n.width(0);window.setTimeout(function(){n.width(q)},300)}f.remove()},minHeight:480,modal:!0,open:function(l,
q){d(".ui-widget-overlay").bind("click",function(){f.dialog("close")})},title:l,minWidth:320,closeText:""})},_bindEvents:function(){return!0},_unbindEvents:function(){return!0}})})(jQuery);
